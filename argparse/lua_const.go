// argparse.lua for gopher-lua https://github.com/mpeterv/argparse
package argparse

const lua_argparse = "LS0gVGhlIE1JVCBMaWNlbnNlIChNSVQpCgotLSBDb3B5cmlnaHQgKGMpIDIwMTMgLSAyMDE4IFBldGVyIE1lbG5pY2hlbmtvCi0tICAgICAgICAgICAgICAgICAgICAgIDIwMTkgUGF1bCBPdWVsbGV0dGUKCi0tIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uIG9idGFpbmluZyBhIGNvcHkgb2YKLS0gdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwgaW4KLS0gdGhlIFNvZnR3YXJlIHdpdGhvdXQgcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0bwotLSB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZgotLSB0aGUgU29mdHdhcmUsIGFuZCB0byBwZXJtaXQgcGVyc29ucyB0byB3aG9tIHRoZSBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sCi0tIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZyBjb25kaXRpb25zOgoKLS0gVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmUgaW5jbHVkZWQgaW4gYWxsCi0tIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCgotLSBUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgIkFTIElTIiwgV0lUSE9VVCBXQVJSQU5UWSBPRiBBTlkgS0lORCwgRVhQUkVTUyBPUgotLSBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUwotLSBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUlMgT1IKLS0gQ09QWVJJR0hUIEhPTERFUlMgQkUgTElBQkxFIEZPUiBBTlkgQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSCi0tIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcgRlJPTSwgT1VUIE9GIE9SIElOCi0tIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEUgU09GVFdBUkUuCgpsb2NhbCBmdW5jdGlvbiBkZWVwX3VwZGF0ZSh0MSwgdDIpCiAgICBmb3IgaywgdiBpbiBwYWlycyh0MikgZG8KICAgICAgICBpZiB0eXBlKHYpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICB2ID0gZGVlcF91cGRhdGUoe30sIHYpCiAgICAgICAgZW5kCgogICAgICAgIHQxW2tdID0gdgogICAgZW5kCgogICAgcmV0dXJuIHQxCmVuZAoKLS0gQSBwcm9wZXJ0eSBpcyBhIHR1cGxlIHtuYW1lLCBjYWxsYmFja30uCi0tIHByb3BlcnRpZXMuYXJncyBpcyBudW1iZXIgb2YgcHJvcGVydGllcyB0aGF0IGNhbiBiZSBzZXQgYXMgYXJndW1lbnRzCi0tIHdoZW4gY2FsbGluZyBhbiBvYmplY3QuCmxvY2FsIGZ1bmN0aW9uIGNsYXNzKHByb3RvdHlwZSwgcHJvcGVydGllcywgcGFyZW50KQogICAgLS0gQ2xhc3MgaXMgdGhlIG1ldGF0YWJsZSBvZiBpdHMgaW5zdGFuY2VzLgogICAgbG9jYWwgY2wgPSB7fQogICAgY2wuX19pbmRleCA9IGNsCgogICAgaWYgcGFyZW50IHRoZW4KICAgICAgICBjbC5fX3Byb3RvdHlwZSA9IGRlZXBfdXBkYXRlKGRlZXBfdXBkYXRlKHt9LCBwYXJlbnQuX19wcm90b3R5cGUpLCBwcm90b3R5cGUpCiAgICBlbHNlCiAgICAgICAgY2wuX19wcm90b3R5cGUgPSBwcm90b3R5cGUKICAgIGVuZAoKICAgIGlmIHByb3BlcnRpZXMgdGhlbgogICAgICAgIGxvY2FsIG5hbWVzID0ge30KCiAgICAgICAgLS0gQ3JlYXRlIHNldHRlciBtZXRob2RzIGFuZCBmaWxsIHNldCBvZiBwcm9wZXJ0eSBuYW1lcy4KICAgICAgICBmb3IgXywgcHJvcGVydHkgaW4gaXBhaXJzKHByb3BlcnRpZXMpIGRvCiAgICAgICAgICAgIGxvY2FsIG5hbWUsIGNhbGxiYWNrID0gcHJvcGVydHlbMV0sIHByb3BlcnR5WzJdCgogICAgICAgICAgICBjbFtuYW1lXSA9IGZ1bmN0aW9uKHNlbGYsIHZhbHVlKQogICAgICAgICAgICAgICAgaWYgbm90IGNhbGxiYWNrKHNlbGYsIHZhbHVlKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2VsZlsiXyIgLi4gbmFtZV0gPSB2YWx1ZQogICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYKICAgICAgICAgICAgZW5kCgogICAgICAgICAgICBuYW1lc1tuYW1lXSA9IHRydWUKICAgICAgICBlbmQKCiAgICAgICAgZnVuY3Rpb24gY2wuX19jYWxsKHNlbGYsIC4uLikKICAgICAgICAgICAgLS0gV2hlbiBjYWxsaW5nIGFuIG9iamVjdCwgaWYgdGhlIGZpcnN0IGFyZ3VtZW50IGlzIGEgdGFibGUsCiAgICAgICAgICAgIC0tIGludGVycHJldCBrZXlzIGFzIHByb3BlcnR5IG5hbWVzLCBlbHNlIGRlbGVnYXRlIGFyZ3VtZW50cwogICAgICAgICAgICAtLSB0byBjb3JyZXNwb25kaW5nIHNldHRlcnMgaW4gb3JkZXIuCiAgICAgICAgICAgIGxvY2FsIGZpcnN0ID0gLi4uCiAgICAgICAgICAgIGlmIHR5cGUoZmlyc3QpID09ICJ0YWJsZSIgdGhlbgogICAgICAgICAgICAgICAgZm9yIG5hbWUsIHZhbHVlIGluIHBhaXJzKGZpcnN0KSBkbwogICAgICAgICAgICAgICAgICAgIGlmIG5hbWVzW25hbWVdIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZltuYW1lXShzZWxmLCB2YWx1ZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBsb2NhbCBuYXJncyA9IHNlbGVjdCgiIyIsIC4uLikKCiAgICAgICAgICAgICAgICBmb3IgaSwgcHJvcGVydHkgaW4gaXBhaXJzKHByb3BlcnRpZXMpIGRvCiAgICAgICAgICAgICAgICAgICAgaWYgaSA+IG5hcmdzIG9yIGkgPiBwcm9wZXJ0aWVzLmFyZ3MgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgICAgICBsb2NhbCBhcmcgPSBzZWxlY3QoaSwgLi4uKQoKICAgICAgICAgICAgICAgICAgICBpZiBhcmcgfj0gbmlsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZltwcm9wZXJ0eVsxXV0oc2VsZiwgYXJnKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgcmV0dXJuIHNlbGYKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tIElmIGluZGV4aW5nIGNsYXNzIGZhaWxzLCBmYWxsYmFjayB0byBpdHMgcGFyZW50LgogICAgbG9jYWwgY2xhc3NfbWV0YXRhYmxlID0ge30KICAgIGNsYXNzX21ldGF0YWJsZS5fX2luZGV4ID0gcGFyZW50CgogICAgZnVuY3Rpb24gY2xhc3NfbWV0YXRhYmxlLl9fY2FsbChzZWxmLCAuLi4pCiAgICAgICAgLS0gQ2FsbGluZyBhIGNsYXNzIHJldHVybnMgaXRzIGluc3RhbmNlLgogICAgICAgIC0tIEFyZ3VtZW50cyBhcmUgZGVsZWdhdGVkIHRvIHRoZSBpbnN0YW5jZS4KICAgICAgICBsb2NhbCBvYmplY3QgPSBkZWVwX3VwZGF0ZSh7fSwgc2VsZi5fX3Byb3RvdHlwZSkKICAgICAgICBzZXRtZXRhdGFibGUob2JqZWN0LCBzZWxmKQogICAgICAgIHJldHVybiBvYmplY3QoLi4uKQogICAgZW5kCgogICAgcmV0dXJuIHNldG1ldGF0YWJsZShjbCwgY2xhc3NfbWV0YXRhYmxlKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHR5cGVjaGVjayhuYW1lLCB0eXBlcywgdmFsdWUpCiAgICBmb3IgXywgdHlwZV8gaW4gaXBhaXJzKHR5cGVzKSBkbwogICAgICAgIGlmIHR5cGUodmFsdWUpID09IHR5cGVfIHRoZW4KICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGVycm9yKCgiYmFkIHByb3BlcnR5ICclcycgKCVzIGV4cGVjdGVkLCBnb3QgJXMpIik6Zm9ybWF0KG5hbWUsIHRhYmxlLmNvbmNhdCh0eXBlcywgIiBvciAiKSwgdHlwZSh2YWx1ZSkpKQplbmQKCmxvY2FsIGZ1bmN0aW9uIHR5cGVjaGVja2VkKG5hbWUsIC4uLikKICAgIGxvY2FsIHR5cGVzID0gey4uLn0KICAgIHJldHVybiB7bmFtZSwgZnVuY3Rpb24oXywgdmFsdWUpIHR5cGVjaGVjayhuYW1lLCB0eXBlcywgdmFsdWUpIGVuZH0KZW5kCgpsb2NhbCBtdWx0aW5hbWUgPSB7Im5hbWUiLCBmdW5jdGlvbihzZWxmLCB2YWx1ZSkKICAgIHR5cGVjaGVjaygibmFtZSIsIHsic3RyaW5nIn0sIHZhbHVlKQoKICAgIGZvciBhbGlhcyBpbiB2YWx1ZTpnbWF0Y2goIiVTKyIpIGRvCiAgICAgICAgc2VsZi5fbmFtZSA9IHNlbGYuX25hbWUgb3IgYWxpYXMKICAgICAgICB0YWJsZS5pbnNlcnQoc2VsZi5fYWxpYXNlcywgYWxpYXMpCiAgICAgICAgdGFibGUuaW5zZXJ0KHNlbGYuX3B1YmxpY19hbGlhc2VzLCBhbGlhcykKICAgICAgICAtLSBJZiBhbGlhcyBjb250YWlucyAnXycsIGFjY2VwdCAnLScgYWxzby4KICAgICAgICBpZiBhbGlhczpmaW5kKCJfIiwgMSwgdHJ1ZSkgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQoc2VsZi5fYWxpYXNlcywgKGFsaWFzOmdzdWIoIl8iLCAiLSIpKSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIC0tIERvIG5vdCBzZXQgX25hbWUgYXMgd2l0aCBvdGhlciBwcm9wZXJ0aWVzLgogICAgcmV0dXJuIHRydWUKZW5kfQoKbG9jYWwgbXVsdGluYW1lX2hpZGRlbiA9IHsiaGlkZGVuX25hbWUiLCBmdW5jdGlvbihzZWxmLCB2YWx1ZSkKICAgIHR5cGVjaGVjaygiaGlkZGVuX25hbWUiLCB7InN0cmluZyJ9LCB2YWx1ZSkKCiAgICBmb3IgYWxpYXMgaW4gdmFsdWU6Z21hdGNoKCIlUysiKSBkbwogICAgICAgIHRhYmxlLmluc2VydChzZWxmLl9hbGlhc2VzLCBhbGlhcykKICAgICAgICBpZiBhbGlhczpmaW5kKCJfIiwgMSwgdHJ1ZSkgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQoc2VsZi5fYWxpYXNlcywgKGFsaWFzOmdzdWIoIl8iLCAiLSIpKSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJldHVybiB0cnVlCmVuZH0KCmxvY2FsIGZ1bmN0aW9uIHBhcnNlX2JvdW5kYXJpZXMoc3RyKQogICAgaWYgdG9udW1iZXIoc3RyKSB0aGVuCiAgICAgICAgcmV0dXJuIHRvbnVtYmVyKHN0ciksIHRvbnVtYmVyKHN0cikKICAgIGVuZAoKICAgIGlmIHN0ciA9PSAiKiIgdGhlbgogICAgICAgIHJldHVybiAwLCBtYXRoLmh1Z2UKICAgIGVuZAoKICAgIGlmIHN0ciA9PSAiKyIgdGhlbgogICAgICAgIHJldHVybiAxLCBtYXRoLmh1Z2UKICAgIGVuZAoKICAgIGlmIHN0ciA9PSAiPyIgdGhlbgogICAgICAgIHJldHVybiAwLCAxCiAgICBlbmQKCiAgICBpZiBzdHI6bWF0Y2ggIl4lZCslLSVkKyQiIHRoZW4KICAgICAgICBsb2NhbCBtaW4sIG1heCA9IHN0cjptYXRjaCAiXiglZCspJS0oJWQrKSQiCiAgICAgICAgcmV0dXJuIHRvbnVtYmVyKG1pbiksIHRvbnVtYmVyKG1heCkKICAgIGVuZAoKICAgIGlmIHN0cjptYXRjaCAiXiVkKyUrJCIgdGhlbgogICAgICAgIGxvY2FsIG1pbiA9IHN0cjptYXRjaCAiXiglZCspJSskIgogICAgICAgIHJldHVybiB0b251bWJlcihtaW4pLCBtYXRoLmh1Z2UKICAgIGVuZAplbmQKCmxvY2FsIGZ1bmN0aW9uIGJvdW5kYXJpZXMobmFtZSkKICAgIHJldHVybiB7bmFtZSwgZnVuY3Rpb24oc2VsZiwgdmFsdWUpCiAgICAgICAgdHlwZWNoZWNrKG5hbWUsIHsibnVtYmVyIiwgInN0cmluZyJ9LCB2YWx1ZSkKCiAgICAgICAgbG9jYWwgbWluLCBtYXggPSBwYXJzZV9ib3VuZGFyaWVzKHZhbHVlKQoKICAgICAgICBpZiBub3QgbWluIHRoZW4KICAgICAgICAgICAgZXJyb3IoKCJiYWQgcHJvcGVydHkgJyVzJyIpOmZvcm1hdChuYW1lKSkKICAgICAgICBlbmQKCiAgICAgICAgc2VsZlsiX21pbiIgLi4gbmFtZV0sIHNlbGZbIl9tYXgiIC4uIG5hbWVdID0gbWluLCBtYXgKICAgIGVuZH0KZW5kCgpsb2NhbCBhY3Rpb25zID0ge30KCmxvY2FsIG9wdGlvbl9hY3Rpb24gPSB7ImFjdGlvbiIsIGZ1bmN0aW9uKF8sIHZhbHVlKQogICAgdHlwZWNoZWNrKCJhY3Rpb24iLCB7ImZ1bmN0aW9uIiwgInN0cmluZyJ9LCB2YWx1ZSkKCiAgICBpZiB0eXBlKHZhbHVlKSA9PSAic3RyaW5nIiBhbmQgbm90IGFjdGlvbnNbdmFsdWVdIHRoZW4KICAgICAgICBlcnJvcigoInVua25vd24gYWN0aW9uICclcyciKTpmb3JtYXQodmFsdWUpKQogICAgZW5kCmVuZH0KCmxvY2FsIG9wdGlvbl9pbml0ID0geyJpbml0IiwgZnVuY3Rpb24oc2VsZikKICAgIHNlbGYuX2hhc19pbml0ID0gdHJ1ZQplbmR9Cgpsb2NhbCBvcHRpb25fZGVmYXVsdCA9IHsiZGVmYXVsdCIsIGZ1bmN0aW9uKHNlbGYsIHZhbHVlKQogICAgaWYgdHlwZSh2YWx1ZSkgfj0gInN0cmluZyIgdGhlbgogICAgICAgIHNlbGYuX2luaXQgPSB2YWx1ZQogICAgICAgIHNlbGYuX2hhc19pbml0ID0gdHJ1ZQogICAgICAgIHJldHVybiB0cnVlCiAgICBlbmQKZW5kfQoKbG9jYWwgYWRkX2hlbHAgPSB7ImFkZF9oZWxwIiwgZnVuY3Rpb24oc2VsZiwgdmFsdWUpCiAgICB0eXBlY2hlY2soImFkZF9oZWxwIiwgeyJib29sZWFuIiwgInN0cmluZyIsICJ0YWJsZSJ9LCB2YWx1ZSkKCiAgICBpZiBzZWxmLl9oZWxwX29wdGlvbl9pZHggdGhlbgogICAgICAgIHRhYmxlLnJlbW92ZShzZWxmLl9vcHRpb25zLCBzZWxmLl9oZWxwX29wdGlvbl9pZHgpCiAgICAgICAgc2VsZi5faGVscF9vcHRpb25faWR4ID0gbmlsCiAgICBlbmQKCiAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgbG9jYWwgaGVscCA9IHNlbGY6ZmxhZygpCiAgICAgICAgICAgICAgICAgICAgICAgICA6ZGVzY3JpcHRpb24gIlNob3cgdGhpcyBoZWxwIG1lc3NhZ2UgYW5kIGV4aXQuIgogICAgICAgICAgICAgICAgICAgICAgICAgOmFjdGlvbihmdW5jdGlvbigpCiAgICAgICAgICAgIHByaW50KHNlbGY6Z2V0X2hlbHAoKSkKICAgICAgICAgICAgb3MuZXhpdCgwKQogICAgICAgIGVuZCkKCiAgICAgICAgaWYgdmFsdWUgfj0gdHJ1ZSB0aGVuCiAgICAgICAgICAgIGhlbHAgPSBoZWxwKHZhbHVlKQogICAgICAgIGVuZAoKICAgICAgICBpZiBub3QgaGVscC5fbmFtZSB0aGVuCiAgICAgICAgICAgIGhlbHAgIi1oIiAiLS1oZWxwIgogICAgICAgIGVuZAoKICAgICAgICBzZWxmLl9oZWxwX29wdGlvbl9pZHggPSAjc2VsZi5fb3B0aW9ucwogICAgZW5kCmVuZH0KCmxvY2FsIFBhcnNlciA9IGNsYXNzKHsKICAgIF9hcmd1bWVudHMgPSB7fSwKICAgIF9vcHRpb25zID0ge30sCiAgICBfY29tbWFuZHMgPSB7fSwKICAgIF9tdXRleGVzID0ge30sCiAgICBfZ3JvdXBzID0ge30sCiAgICBfcmVxdWlyZV9jb21tYW5kID0gdHJ1ZSwKICAgIF9oYW5kbGVfb3B0aW9ucyA9IHRydWUKfSwgewogICAgYXJncyA9IDMsCiAgICB0eXBlY2hlY2tlZCgibmFtZSIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJkZXNjcmlwdGlvbiIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJlcGlsb2ciLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgidXNhZ2UiLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgiaGVscCIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJyZXF1aXJlX2NvbW1hbmQiLCAiYm9vbGVhbiIpLAogICAgdHlwZWNoZWNrZWQoImhhbmRsZV9vcHRpb25zIiwgImJvb2xlYW4iKSwKICAgIHR5cGVjaGVja2VkKCJhY3Rpb24iLCAiZnVuY3Rpb24iKSwKICAgIHR5cGVjaGVja2VkKCJjb21tYW5kX3RhcmdldCIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJoZWxwX3ZlcnRpY2FsX3NwYWNlIiwgIm51bWJlciIpLAogICAgdHlwZWNoZWNrZWQoInVzYWdlX21hcmdpbiIsICJudW1iZXIiKSwKICAgIHR5cGVjaGVja2VkKCJ1c2FnZV9tYXhfd2lkdGgiLCAibnVtYmVyIiksCiAgICB0eXBlY2hlY2tlZCgiaGVscF91c2FnZV9tYXJnaW4iLCAibnVtYmVyIiksCiAgICB0eXBlY2hlY2tlZCgiaGVscF9kZXNjcmlwdGlvbl9tYXJnaW4iLCAibnVtYmVyIiksCiAgICB0eXBlY2hlY2tlZCgiaGVscF9tYXhfd2lkdGgiLCAibnVtYmVyIiksCiAgICBhZGRfaGVscAp9KQoKbG9jYWwgQ29tbWFuZCA9IGNsYXNzKHsKICAgIF9hbGlhc2VzID0ge30sCiAgICBfcHVibGljX2FsaWFzZXMgPSB7fQp9LCB7CiAgICBhcmdzID0gMywKICAgIG11bHRpbmFtZSwKICAgIHR5cGVjaGVja2VkKCJkZXNjcmlwdGlvbiIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJlcGlsb2ciLCAic3RyaW5nIiksCiAgICBtdWx0aW5hbWVfaGlkZGVuLAogICAgdHlwZWNoZWNrZWQoInN1bW1hcnkiLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgidGFyZ2V0IiwgInN0cmluZyIpLAogICAgdHlwZWNoZWNrZWQoInVzYWdlIiwgInN0cmluZyIpLAogICAgdHlwZWNoZWNrZWQoImhlbHAiLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgicmVxdWlyZV9jb21tYW5kIiwgImJvb2xlYW4iKSwKICAgIHR5cGVjaGVja2VkKCJoYW5kbGVfb3B0aW9ucyIsICJib29sZWFuIiksCiAgICB0eXBlY2hlY2tlZCgiYWN0aW9uIiwgImZ1bmN0aW9uIiksCiAgICB0eXBlY2hlY2tlZCgiY29tbWFuZF90YXJnZXQiLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgiaGVscF92ZXJ0aWNhbF9zcGFjZSIsICJudW1iZXIiKSwKICAgIHR5cGVjaGVja2VkKCJ1c2FnZV9tYXJnaW4iLCAibnVtYmVyIiksCiAgICB0eXBlY2hlY2tlZCgidXNhZ2VfbWF4X3dpZHRoIiwgIm51bWJlciIpLAogICAgdHlwZWNoZWNrZWQoImhlbHBfdXNhZ2VfbWFyZ2luIiwgIm51bWJlciIpLAogICAgdHlwZWNoZWNrZWQoImhlbHBfZGVzY3JpcHRpb25fbWFyZ2luIiwgIm51bWJlciIpLAogICAgdHlwZWNoZWNrZWQoImhlbHBfbWF4X3dpZHRoIiwgIm51bWJlciIpLAogICAgdHlwZWNoZWNrZWQoImhpZGRlbiIsICJib29sZWFuIiksCiAgICBhZGRfaGVscAp9LCBQYXJzZXIpCgpsb2NhbCBBcmd1bWVudCA9IGNsYXNzKHsKICAgIF9taW5hcmdzID0gMSwKICAgIF9tYXhhcmdzID0gMSwKICAgIF9taW5jb3VudCA9IDEsCiAgICBfbWF4Y291bnQgPSAxLAogICAgX2RlZm1vZGUgPSAidW51c2VkIiwKICAgIF9zaG93X2RlZmF1bHQgPSB0cnVlCn0sIHsKICAgIGFyZ3MgPSA1LAogICAgdHlwZWNoZWNrZWQoIm5hbWUiLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgiZGVzY3JpcHRpb24iLCAic3RyaW5nIiksCiAgICBvcHRpb25fZGVmYXVsdCwKICAgIHR5cGVjaGVja2VkKCJjb252ZXJ0IiwgImZ1bmN0aW9uIiwgInRhYmxlIiksCiAgICBib3VuZGFyaWVzKCJhcmdzIiksCiAgICB0eXBlY2hlY2tlZCgidGFyZ2V0IiwgInN0cmluZyIpLAogICAgdHlwZWNoZWNrZWQoImRlZm1vZGUiLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgic2hvd19kZWZhdWx0IiwgImJvb2xlYW4iKSwKICAgIHR5cGVjaGVja2VkKCJhcmduYW1lIiwgInN0cmluZyIsICJ0YWJsZSIpLAogICAgdHlwZWNoZWNrZWQoImNob2ljZXMiLCAidGFibGUiKSwKICAgIHR5cGVjaGVja2VkKCJoaWRkZW4iLCAiYm9vbGVhbiIpLAogICAgb3B0aW9uX2FjdGlvbiwKICAgIG9wdGlvbl9pbml0Cn0pCgpsb2NhbCBPcHRpb24gPSBjbGFzcyh7CiAgICBfYWxpYXNlcyA9IHt9LAogICAgX3B1YmxpY19hbGlhc2VzID0ge30sCiAgICBfbWluY291bnQgPSAwLAogICAgX292ZXJ3cml0ZSA9IHRydWUKfSwgewogICAgYXJncyA9IDYsCiAgICBtdWx0aW5hbWUsCiAgICB0eXBlY2hlY2tlZCgiZGVzY3JpcHRpb24iLCAic3RyaW5nIiksCiAgICBvcHRpb25fZGVmYXVsdCwKICAgIHR5cGVjaGVja2VkKCJjb252ZXJ0IiwgImZ1bmN0aW9uIiwgInRhYmxlIiksCiAgICBib3VuZGFyaWVzKCJhcmdzIiksCiAgICBib3VuZGFyaWVzKCJjb3VudCIpLAogICAgbXVsdGluYW1lX2hpZGRlbiwKICAgIHR5cGVjaGVja2VkKCJ0YXJnZXQiLCAic3RyaW5nIiksCiAgICB0eXBlY2hlY2tlZCgiZGVmbW9kZSIsICJzdHJpbmciKSwKICAgIHR5cGVjaGVja2VkKCJzaG93X2RlZmF1bHQiLCAiYm9vbGVhbiIpLAogICAgdHlwZWNoZWNrZWQoIm92ZXJ3cml0ZSIsICJib29sZWFuIiksCiAgICB0eXBlY2hlY2tlZCgiYXJnbmFtZSIsICJzdHJpbmciLCAidGFibGUiKSwKICAgIHR5cGVjaGVja2VkKCJjaG9pY2VzIiwgInRhYmxlIiksCiAgICB0eXBlY2hlY2tlZCgiaGlkZGVuIiwgImJvb2xlYW4iKSwKICAgIG9wdGlvbl9hY3Rpb24sCiAgICBvcHRpb25faW5pdAp9LCBBcmd1bWVudCkKCmZ1bmN0aW9uIFBhcnNlcjpfaW5oZXJpdF9wcm9wZXJ0eShuYW1lLCBkZWZhdWx0KQogICAgbG9jYWwgZWxlbWVudCA9IHNlbGYKCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgbG9jYWwgdmFsdWUgPSBlbGVtZW50WyJfIiAuLiBuYW1lXQoKICAgICAgICBpZiB2YWx1ZSB+PSBuaWwgdGhlbgogICAgICAgICAgICByZXR1cm4gdmFsdWUKICAgICAgICBlbmQKCiAgICAgICAgaWYgbm90IGVsZW1lbnQuX3BhcmVudCB0aGVuCiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0CiAgICAgICAgZW5kCgogICAgICAgIGVsZW1lbnQgPSBlbGVtZW50Ll9wYXJlbnQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIEFyZ3VtZW50Ol9nZXRfYXJndW1lbnRfbGlzdCgpCiAgICBsb2NhbCBidWYgPSB7fQogICAgbG9jYWwgaSA9IDEKCiAgICB3aGlsZSBpIDw9IG1hdGgubWluKHNlbGYuX21pbmFyZ3MsIDMpIGRvCiAgICAgICAgbG9jYWwgYXJnbmFtZSA9IHNlbGY6X2dldF9hcmduYW1lKGkpCgogICAgICAgIGlmIHNlbGYuX2RlZmF1bHQgYW5kIHNlbGYuX2RlZm1vZGU6ZmluZCAiYSIgdGhlbgogICAgICAgICAgICBhcmduYW1lID0gIlsiIC4uIGFyZ25hbWUgLi4gIl0iCiAgICAgICAgZW5kCgogICAgICAgIHRhYmxlLmluc2VydChidWYsIGFyZ25hbWUpCiAgICAgICAgaSA9IGkrMQogICAgZW5kCgogICAgd2hpbGUgaSA8PSBtYXRoLm1pbihzZWxmLl9tYXhhcmdzLCAzKSBkbwogICAgICAgIHRhYmxlLmluc2VydChidWYsICJbIiAuLiBzZWxmOl9nZXRfYXJnbmFtZShpKSAuLiAiXSIpCiAgICAgICAgaSA9IGkrMQoKICAgICAgICBpZiBzZWxmLl9tYXhhcmdzID09IG1hdGguaHVnZSB0aGVuCiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiBpIDwgc2VsZi5fbWF4YXJncyB0aGVuCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgIi4uLiIpCiAgICBlbmQKCiAgICByZXR1cm4gYnVmCmVuZAoKZnVuY3Rpb24gQXJndW1lbnQ6X2dldF91c2FnZSgpCiAgICBsb2NhbCB1c2FnZSA9IHRhYmxlLmNvbmNhdChzZWxmOl9nZXRfYXJndW1lbnRfbGlzdCgpLCAiICIpCgogICAgaWYgc2VsZi5fZGVmYXVsdCBhbmQgc2VsZi5fZGVmbW9kZTpmaW5kICJ1IiB0aGVuCiAgICAgICAgaWYgc2VsZi5fbWF4YXJncyA+IDEgb3IgKHNlbGYuX21pbmFyZ3MgPT0gMSBhbmQgbm90IHNlbGYuX2RlZm1vZGU6ZmluZCAiYSIpIHRoZW4KICAgICAgICAgICAgdXNhZ2UgPSAiWyIgLi4gdXNhZ2UgLi4gIl0iCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICByZXR1cm4gdXNhZ2UKZW5kCgpmdW5jdGlvbiBhY3Rpb25zLnN0b3JlX3RydWUocmVzdWx0LCB0YXJnZXQpCiAgICByZXN1bHRbdGFyZ2V0XSA9IHRydWUKZW5kCgpmdW5jdGlvbiBhY3Rpb25zLnN0b3JlX2ZhbHNlKHJlc3VsdCwgdGFyZ2V0KQogICAgcmVzdWx0W3RhcmdldF0gPSBmYWxzZQplbmQKCmZ1bmN0aW9uIGFjdGlvbnMuc3RvcmUocmVzdWx0LCB0YXJnZXQsIGFyZ3VtZW50KQogICAgcmVzdWx0W3RhcmdldF0gPSBhcmd1bWVudAplbmQKCmZ1bmN0aW9uIGFjdGlvbnMuY291bnQocmVzdWx0LCB0YXJnZXQsIF8sIG92ZXJ3cml0ZSkKICAgIGlmIG5vdCBvdmVyd3JpdGUgdGhlbgogICAgICAgIHJlc3VsdFt0YXJnZXRdID0gcmVzdWx0W3RhcmdldF0gKyAxCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBhY3Rpb25zLmFwcGVuZChyZXN1bHQsIHRhcmdldCwgYXJndW1lbnQsIG92ZXJ3cml0ZSkKICAgIHJlc3VsdFt0YXJnZXRdID0gcmVzdWx0W3RhcmdldF0gb3Ige30KICAgIHRhYmxlLmluc2VydChyZXN1bHRbdGFyZ2V0XSwgYXJndW1lbnQpCgogICAgaWYgb3ZlcndyaXRlIHRoZW4KICAgICAgICB0YWJsZS5yZW1vdmUocmVzdWx0W3RhcmdldF0sIDEpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBhY3Rpb25zLmNvbmNhdChyZXN1bHQsIHRhcmdldCwgYXJndW1lbnRzLCBvdmVyd3JpdGUpCiAgICBpZiBvdmVyd3JpdGUgdGhlbgogICAgICAgIGVycm9yKCInY29uY2F0JyBhY3Rpb24gY2FuJ3QgaGFuZGxlIHRvbyBtYW55IGludm9jYXRpb25zIikKICAgIGVuZAoKICAgIHJlc3VsdFt0YXJnZXRdID0gcmVzdWx0W3RhcmdldF0gb3Ige30KCiAgICBmb3IgXywgYXJndW1lbnQgaW4gaXBhaXJzKGFyZ3VtZW50cykgZG8KICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0W3RhcmdldF0sIGFyZ3VtZW50KQogICAgZW5kCmVuZAoKZnVuY3Rpb24gQXJndW1lbnQ6X2dldF9hY3Rpb24oKQogICAgbG9jYWwgYWN0aW9uLCBpbml0CgogICAgaWYgc2VsZi5fbWF4Y291bnQgPT0gMSB0aGVuCiAgICAgICAgaWYgc2VsZi5fbWF4YXJncyA9PSAwIHRoZW4KICAgICAgICAgICAgYWN0aW9uLCBpbml0ID0gInN0b3JlX3RydWUiLCBuaWwKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFjdGlvbiwgaW5pdCA9ICJzdG9yZSIsIG5pbAogICAgICAgIGVuZAogICAgZWxzZQogICAgICAgIGlmIHNlbGYuX21heGFyZ3MgPT0gMCB0aGVuCiAgICAgICAgICAgIGFjdGlvbiwgaW5pdCA9ICJjb3VudCIsIDAKICAgICAgICBlbHNlCiAgICAgICAgICAgIGFjdGlvbiwgaW5pdCA9ICJhcHBlbmQiLCB7fQogICAgICAgIGVuZAogICAgZW5kCgogICAgaWYgc2VsZi5fYWN0aW9uIHRoZW4KICAgICAgICBhY3Rpb24gPSBzZWxmLl9hY3Rpb24KICAgIGVuZAoKICAgIGlmIHNlbGYuX2hhc19pbml0IHRoZW4KICAgICAgICBpbml0ID0gc2VsZi5faW5pdAogICAgZW5kCgogICAgaWYgdHlwZShhY3Rpb24pID09ICJzdHJpbmciIHRoZW4KICAgICAgICBhY3Rpb24gPSBhY3Rpb25zW2FjdGlvbl0KICAgIGVuZAoKICAgIHJldHVybiBhY3Rpb24sIGluaXQKZW5kCgotLSBSZXR1cm5zIHBsYWNlaG9sZGVyIGZvciBgbmFyZ2AtdGggYXJndW1lbnQuCmZ1bmN0aW9uIEFyZ3VtZW50Ol9nZXRfYXJnbmFtZShuYXJnKQogICAgbG9jYWwgYXJnbmFtZSA9IHNlbGYuX2FyZ25hbWUgb3Igc2VsZjpfZ2V0X2RlZmF1bHRfYXJnbmFtZSgpCgogICAgaWYgdHlwZShhcmduYW1lKSA9PSAidGFibGUiIHRoZW4KICAgICAgICByZXR1cm4gYXJnbmFtZVtuYXJnXQogICAgZWxzZQogICAgICAgIHJldHVybiBhcmduYW1lCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBBcmd1bWVudDpfZ2V0X2Nob2ljZXNfbGlzdCgpCiAgICByZXR1cm4gInsiIC4uIHRhYmxlLmNvbmNhdChzZWxmLl9jaG9pY2VzLCAiLCIpIC4uICJ9IgplbmQKCmZ1bmN0aW9uIEFyZ3VtZW50Ol9nZXRfZGVmYXVsdF9hcmduYW1lKCkKICAgIGlmIHNlbGYuX2Nob2ljZXMgdGhlbgogICAgICAgIHJldHVybiBzZWxmOl9nZXRfY2hvaWNlc19saXN0KCkKICAgIGVsc2UKICAgICAgICByZXR1cm4gIjwiIC4uIHNlbGYuX25hbWUgLi4gIj4iCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBPcHRpb246X2dldF9kZWZhdWx0X2FyZ25hbWUoKQogICAgaWYgc2VsZi5fY2hvaWNlcyB0aGVuCiAgICAgICAgcmV0dXJuIHNlbGY6X2dldF9jaG9pY2VzX2xpc3QoKQogICAgZWxzZQogICAgICAgIHJldHVybiAiPCIgLi4gc2VsZjpfZ2V0X2RlZmF1bHRfdGFyZ2V0KCkgLi4gIj4iCiAgICBlbmQKZW5kCgotLSBSZXR1cm5zIGxhYmVscyB0byBiZSBzaG93biBpbiB0aGUgaGVscCBtZXNzYWdlLgpmdW5jdGlvbiBBcmd1bWVudDpfZ2V0X2xhYmVsX2xpbmVzKCkKICAgIGlmIHNlbGYuX2Nob2ljZXMgdGhlbgogICAgICAgIHJldHVybiB7c2VsZjpfZ2V0X2Nob2ljZXNfbGlzdCgpfQogICAgZWxzZQogICAgICAgIHJldHVybiB7c2VsZi5fbmFtZX0KICAgIGVuZAplbmQKCmZ1bmN0aW9uIE9wdGlvbjpfZ2V0X2xhYmVsX2xpbmVzKCkKICAgIGxvY2FsIGFyZ3VtZW50X2xpc3QgPSBzZWxmOl9nZXRfYXJndW1lbnRfbGlzdCgpCgogICAgaWYgI2FyZ3VtZW50X2xpc3QgPT0gMCB0aGVuCiAgICAgICAgLS0gRG9uJ3QgcHV0IGFsaWFzZXMgZm9yIHNpbXBsZSBmbGFncyBsaWtlIGAtaGAgb24gZGlmZmVyZW50IGxpbmVzLgogICAgICAgIHJldHVybiB7dGFibGUuY29uY2F0KHNlbGYuX3B1YmxpY19hbGlhc2VzLCAiLCAiKX0KICAgIGVuZAoKICAgIGxvY2FsIGxvbmdlc3RfYWxpYXNfbGVuZ3RoID0gLTEKCiAgICBmb3IgXywgYWxpYXMgaW4gaXBhaXJzKHNlbGYuX3B1YmxpY19hbGlhc2VzKSBkbwogICAgICAgIGxvbmdlc3RfYWxpYXNfbGVuZ3RoID0gbWF0aC5tYXgobG9uZ2VzdF9hbGlhc19sZW5ndGgsICNhbGlhcykKICAgIGVuZAoKICAgIGxvY2FsIGFyZ3VtZW50X2xpc3RfcmVwciA9IHRhYmxlLmNvbmNhdChhcmd1bWVudF9saXN0LCAiICIpCiAgICBsb2NhbCBsaW5lcyA9IHt9CgogICAgZm9yIGksIGFsaWFzIGluIGlwYWlycyhzZWxmLl9wdWJsaWNfYWxpYXNlcykgZG8KICAgICAgICBsb2NhbCBsaW5lID0gKCIgIik6cmVwKGxvbmdlc3RfYWxpYXNfbGVuZ3RoIC0gI2FsaWFzKSAuLiBhbGlhcyAuLiAiICIgLi4gYXJndW1lbnRfbGlzdF9yZXByCgogICAgICAgIGlmIGkgfj0gI3NlbGYuX3B1YmxpY19hbGlhc2VzIHRoZW4KICAgICAgICAgICAgbGluZSA9IGxpbmUgLi4gIiwiCiAgICAgICAgZW5kCgogICAgICAgIHRhYmxlLmluc2VydChsaW5lcywgbGluZSkKICAgIGVuZAoKICAgIHJldHVybiBsaW5lcwplbmQKCmZ1bmN0aW9uIENvbW1hbmQ6X2dldF9sYWJlbF9saW5lcygpCiAgICByZXR1cm4ge3RhYmxlLmNvbmNhdChzZWxmLl9wdWJsaWNfYWxpYXNlcywgIiwgIil9CmVuZAoKZnVuY3Rpb24gQXJndW1lbnQ6X2dldF9kZXNjcmlwdGlvbigpCiAgICBpZiBzZWxmLl9kZWZhdWx0IGFuZCBzZWxmLl9zaG93X2RlZmF1bHQgdGhlbgogICAgICAgIGlmIHNlbGYuX2Rlc2NyaXB0aW9uIHRoZW4KICAgICAgICAgICAgcmV0dXJuICgiJXMgKGRlZmF1bHQ6ICVzKSIpOmZvcm1hdChzZWxmLl9kZXNjcmlwdGlvbiwgc2VsZi5fZGVmYXVsdCkKICAgICAgICBlbHNlCiAgICAgICAgICAgIHJldHVybiAoImRlZmF1bHQ6ICVzIik6Zm9ybWF0KHNlbGYuX2RlZmF1bHQpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgcmV0dXJuIHNlbGYuX2Rlc2NyaXB0aW9uIG9yICIiCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBDb21tYW5kOl9nZXRfZGVzY3JpcHRpb24oKQogICAgcmV0dXJuIHNlbGYuX3N1bW1hcnkgb3Igc2VsZi5fZGVzY3JpcHRpb24gb3IgIiIKZW5kCgpmdW5jdGlvbiBPcHRpb246X2dldF91c2FnZSgpCiAgICBsb2NhbCB1c2FnZSA9IHNlbGY6X2dldF9hcmd1bWVudF9saXN0KCkKICAgIHRhYmxlLmluc2VydCh1c2FnZSwgMSwgc2VsZi5fbmFtZSkKICAgIHVzYWdlID0gdGFibGUuY29uY2F0KHVzYWdlLCAiICIpCgogICAgaWYgc2VsZi5fbWluY291bnQgPT0gMCBvciBzZWxmLl9kZWZhdWx0IHRoZW4KICAgICAgICB1c2FnZSA9ICJbIiAuLiB1c2FnZSAuLiAiXSIKICAgIGVuZAoKICAgIHJldHVybiB1c2FnZQplbmQKCmZ1bmN0aW9uIEFyZ3VtZW50Ol9nZXRfZGVmYXVsdF90YXJnZXQoKQogICAgcmV0dXJuIHNlbGYuX25hbWUKZW5kCgpmdW5jdGlvbiBPcHRpb246X2dldF9kZWZhdWx0X3RhcmdldCgpCiAgICBsb2NhbCByZXMKCiAgICBmb3IgXywgYWxpYXMgaW4gaXBhaXJzKHNlbGYuX3B1YmxpY19hbGlhc2VzKSBkbwogICAgICAgIGlmIGFsaWFzOnN1YigxLCAxKSA9PSBhbGlhczpzdWIoMiwgMikgdGhlbgogICAgICAgICAgICByZXMgPSBhbGlhczpzdWIoMykKICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJlcyA9IHJlcyBvciBzZWxmLl9uYW1lOnN1YigyKQogICAgcmV0dXJuIChyZXM6Z3N1YigiLSIsICJfIikpCmVuZAoKZnVuY3Rpb24gT3B0aW9uOl9pc192YXJhcmcoKQogICAgcmV0dXJuIHNlbGYuX21heGFyZ3Mgfj0gc2VsZi5fbWluYXJncwplbmQKCmZ1bmN0aW9uIFBhcnNlcjpfZ2V0X2Z1bGxuYW1lKGV4Y2x1ZGVfcm9vdCkKICAgIGxvY2FsIHBhcmVudCA9IHNlbGYuX3BhcmVudAogICAgaWYgZXhjbHVkZV9yb290IGFuZCBub3QgcGFyZW50IHRoZW4KICAgICAgICByZXR1cm4gIiIKICAgIGVuZAogICAgbG9jYWwgYnVmID0ge3NlbGYuX25hbWV9CgogICAgd2hpbGUgcGFyZW50IGRvCiAgICAgICAgaWYgbm90IGV4Y2x1ZGVfcm9vdCBvciBwYXJlbnQuX3BhcmVudCB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChidWYsIDEsIHBhcmVudC5fbmFtZSkKICAgICAgICBlbmQKICAgICAgICBwYXJlbnQgPSBwYXJlbnQuX3BhcmVudAogICAgZW5kCgogICAgcmV0dXJuIHRhYmxlLmNvbmNhdChidWYsICIgIikKZW5kCgpmdW5jdGlvbiBQYXJzZXI6X3VwZGF0ZV9jaGFyc2V0KGNoYXJzZXQpCiAgICBjaGFyc2V0ID0gY2hhcnNldCBvciB7fQoKICAgIGZvciBfLCBjb21tYW5kIGluIGlwYWlycyhzZWxmLl9jb21tYW5kcykgZG8KICAgICAgICBjb21tYW5kOl91cGRhdGVfY2hhcnNldChjaGFyc2V0KQogICAgZW5kCgogICAgZm9yIF8sIG9wdGlvbiBpbiBpcGFpcnMoc2VsZi5fb3B0aW9ucykgZG8KICAgICAgICBmb3IgXywgYWxpYXMgaW4gaXBhaXJzKG9wdGlvbi5fYWxpYXNlcykgZG8KICAgICAgICAgICAgY2hhcnNldFthbGlhczpzdWIoMSwgMSldID0gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCgogICAgcmV0dXJuIGNoYXJzZXQKZW5kCgpmdW5jdGlvbiBQYXJzZXI6YXJndW1lbnQoLi4uKQogICAgbG9jYWwgYXJndW1lbnQgPSBBcmd1bWVudCguLi4pCiAgICB0YWJsZS5pbnNlcnQoc2VsZi5fYXJndW1lbnRzLCBhcmd1bWVudCkKICAgIHJldHVybiBhcmd1bWVudAplbmQKCmZ1bmN0aW9uIFBhcnNlcjpvcHRpb24oLi4uKQogICAgbG9jYWwgb3B0aW9uID0gT3B0aW9uKC4uLikKICAgIHRhYmxlLmluc2VydChzZWxmLl9vcHRpb25zLCBvcHRpb24pCiAgICByZXR1cm4gb3B0aW9uCmVuZAoKZnVuY3Rpb24gUGFyc2VyOmZsYWcoLi4uKQogICAgcmV0dXJuIHNlbGY6b3B0aW9uKCk6YXJncygwKSguLi4pCmVuZAoKZnVuY3Rpb24gUGFyc2VyOmNvbW1hbmQoLi4uKQogICAgbG9jYWwgY29tbWFuZCA9IENvbW1hbmQoKTphZGRfaGVscCh0cnVlKSguLi4pCiAgICBjb21tYW5kLl9wYXJlbnQgPSBzZWxmCiAgICB0YWJsZS5pbnNlcnQoc2VsZi5fY29tbWFuZHMsIGNvbW1hbmQpCiAgICByZXR1cm4gY29tbWFuZAplbmQKCmZ1bmN0aW9uIFBhcnNlcjptdXRleCguLi4pCiAgICBsb2NhbCBlbGVtZW50cyA9IHsuLi59CgogICAgZm9yIGksIGVsZW1lbnQgaW4gaXBhaXJzKGVsZW1lbnRzKSBkbwogICAgICAgIGxvY2FsIG10ID0gZ2V0bWV0YXRhYmxlKGVsZW1lbnQpCiAgICAgICAgYXNzZXJ0KG10ID09IE9wdGlvbiBvciBtdCA9PSBBcmd1bWVudCwgKCJiYWQgYXJndW1lbnQgIyVkIHRvICdtdXRleCcgKE9wdGlvbiBvciBBcmd1bWVudCBleHBlY3RlZCkiKTpmb3JtYXQoaSkpCiAgICBlbmQKCiAgICB0YWJsZS5pbnNlcnQoc2VsZi5fbXV0ZXhlcywgZWxlbWVudHMpCiAgICByZXR1cm4gc2VsZgplbmQKCmZ1bmN0aW9uIFBhcnNlcjpncm91cChuYW1lLCAuLi4pCiAgICBhc3NlcnQodHlwZShuYW1lKSA9PSAic3RyaW5nIiwgKCJiYWQgYXJndW1lbnQgIzEgdG8gJ2dyb3VwJyAoc3RyaW5nIGV4cGVjdGVkLCBnb3QgJXMpIik6Zm9ybWF0KHR5cGUobmFtZSkpKQoKICAgIGxvY2FsIGdyb3VwID0ge25hbWUgPSBuYW1lLCAuLi59CgogICAgZm9yIGksIGVsZW1lbnQgaW4gaXBhaXJzKGdyb3VwKSBkbwogICAgICAgIGxvY2FsIG10ID0gZ2V0bWV0YXRhYmxlKGVsZW1lbnQpCiAgICAgICAgYXNzZXJ0KG10ID09IE9wdGlvbiBvciBtdCA9PSBBcmd1bWVudCBvciBtdCA9PSBDb21tYW5kLAogICAgICAgICAgICAgICAgKCJiYWQgYXJndW1lbnQgIyVkIHRvICdncm91cCcgKE9wdGlvbiBvciBBcmd1bWVudCBvciBDb21tYW5kIGV4cGVjdGVkKSIpOmZvcm1hdChpICsgMSkpCiAgICBlbmQKCiAgICB0YWJsZS5pbnNlcnQoc2VsZi5fZ3JvdXBzLCBncm91cCkKICAgIHJldHVybiBzZWxmCmVuZAoKbG9jYWwgdXNhZ2Vfd2VsY29tZSA9ICJVc2FnZTogIgoKZnVuY3Rpb24gUGFyc2VyOmdldF91c2FnZSgpCiAgICBpZiBzZWxmLl91c2FnZSB0aGVuCiAgICAgICAgcmV0dXJuIHNlbGYuX3VzYWdlCiAgICBlbmQKCiAgICBsb2NhbCB1c2FnZV9tYXJnaW4gPSBzZWxmOl9pbmhlcml0X3Byb3BlcnR5KCJ1c2FnZV9tYXJnaW4iLCAjdXNhZ2Vfd2VsY29tZSkKICAgIGxvY2FsIG1heF91c2FnZV93aWR0aCA9IHNlbGY6X2luaGVyaXRfcHJvcGVydHkoInVzYWdlX21heF93aWR0aCIsIDcwKQogICAgbG9jYWwgbGluZXMgPSB7dXNhZ2Vfd2VsY29tZSAuLiBzZWxmOl9nZXRfZnVsbG5hbWUoKX0KCiAgICBsb2NhbCBmdW5jdGlvbiBhZGQocykKICAgICAgICBpZiAjbGluZXNbI2xpbmVzXSsxKyNzIDw9IG1heF91c2FnZV93aWR0aCB0aGVuCiAgICAgICAgICAgIGxpbmVzWyNsaW5lc10gPSBsaW5lc1sjbGluZXNdIC4uICIgIiAuLiBzCiAgICAgICAgZWxzZQogICAgICAgICAgICBsaW5lc1sjbGluZXMrMV0gPSAoIiAiKTpyZXAodXNhZ2VfbWFyZ2luKSAuLiBzCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICAtLSBOb3JtYWxseSBvcHRpb25zIGFyZSBiZWZvcmUgcG9zaXRpb25hbCBhcmd1bWVudHMgaW4gdXNhZ2UgbWVzc2FnZXMuCiAgICAtLSBIb3dldmVyLCB2YXJhcmcgb3B0aW9ucyBzaG91bGQgYmUgYWZ0ZXIsIGJlY2F1c2UgdGhleSBjYW4ndCBiZSByZWxpYWJsZSB1c2VkCiAgICAtLSBiZWZvcmUgYSBwb3NpdGlvbmFsIGFyZ3VtZW50LgogICAgLS0gTXV0ZXhlcyBjb21lIGludG8gcGxheSwgdG9vLCBhbmQgYXJlIHNob3duIGFzIHNvb24gYXMgcG9zc2libGUuCiAgICAtLSBPdmVyYWxsLCBvdXRwdXQgdXNhZ2VzIGluIHRoZSBmb2xsb3dpbmcgb3JkZXI6CiAgICAtLSAxLiBNdXRleGVzIHRoYXQgZG9uJ3QgaGF2ZSBwb3NpdGlvbmFsIGFyZ3VtZW50cyBvciB2YXJhcmcgb3B0aW9ucy4KICAgIC0tIDIuIE9wdGlvbnMgdGhhdCBhcmUgbm90IGluIGFueSBtdXRleGVzIGFuZCBhcmUgbm90IHZhcmFyZy4KICAgIC0tIDMuIFBvc2l0aW9uYWwgYXJndW1lbnRzIC0gb24gdGhlaXIgb3duIG9yIGFzIGEgcGFydCBvZiBhIG11dGV4LgogICAgLS0gNC4gUmVtYWluaW5nIG11dGV4ZXMuCiAgICAtLSA1LiBSZW1haW5pbmcgb3B0aW9ucy4KCiAgICBsb2NhbCBlbGVtZW50c19pbl9tdXRleGVzID0ge30KICAgIGxvY2FsIGFkZGVkX2VsZW1lbnRzID0ge30KICAgIGxvY2FsIGFkZGVkX211dGV4ZXMgPSB7fQogICAgbG9jYWwgYXJndW1lbnRfdG9fbXV0ZXhlcyA9IHt9CgogICAgbG9jYWwgZnVuY3Rpb24gYWRkX211dGV4KG11dGV4LCBtYWluX2FyZ3VtZW50KQogICAgICAgIGlmIGFkZGVkX211dGV4ZXNbbXV0ZXhdIHRoZW4KICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZW5kCgogICAgICAgIGFkZGVkX211dGV4ZXNbbXV0ZXhdID0gdHJ1ZQogICAgICAgIGxvY2FsIGJ1ZiA9IHt9CgogICAgICAgIGZvciBfLCBlbGVtZW50IGluIGlwYWlycyhtdXRleCkgZG8KICAgICAgICAgICAgaWYgbm90IGVsZW1lbnQuX2hpZGRlbiBhbmQgbm90IGFkZGVkX2VsZW1lbnRzW2VsZW1lbnRdIHRoZW4KICAgICAgICAgICAgICAgIGlmIGdldG1ldGF0YWJsZShlbGVtZW50KSA9PSBPcHRpb24gb3IgZWxlbWVudCA9PSBtYWluX2FyZ3VtZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCBlbGVtZW50Ol9nZXRfdXNhZ2UoKSkKICAgICAgICAgICAgICAgICAgICBhZGRlZF9lbGVtZW50c1tlbGVtZW50XSA9IHRydWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgI2J1ZiA9PSAxIHRoZW4KICAgICAgICAgICAgYWRkKGJ1ZlsxXSkKICAgICAgICBlbHNlaWYgI2J1ZiA+IDEgdGhlbgogICAgICAgICAgICBhZGQoIigiIC4uIHRhYmxlLmNvbmNhdChidWYsICIgfCAiKSAuLiAiKSIpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBmdW5jdGlvbiBhZGRfZWxlbWVudChlbGVtZW50KQogICAgICAgIGlmIG5vdCBlbGVtZW50Ll9oaWRkZW4gYW5kIG5vdCBhZGRlZF9lbGVtZW50c1tlbGVtZW50XSB0aGVuCiAgICAgICAgICAgIGFkZChlbGVtZW50Ol9nZXRfdXNhZ2UoKSkKICAgICAgICAgICAgYWRkZWRfZWxlbWVudHNbZWxlbWVudF0gPSB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgXywgbXV0ZXggaW4gaXBhaXJzKHNlbGYuX211dGV4ZXMpIGRvCiAgICAgICAgbG9jYWwgaXNfdmFyYXJnID0gZmFsc2UKICAgICAgICBsb2NhbCBoYXNfYXJndW1lbnQgPSBmYWxzZQoKICAgICAgICBmb3IgXywgZWxlbWVudCBpbiBpcGFpcnMobXV0ZXgpIGRvCiAgICAgICAgICAgIGlmIGdldG1ldGF0YWJsZShlbGVtZW50KSA9PSBPcHRpb24gdGhlbgogICAgICAgICAgICAgICAgaWYgZWxlbWVudDpfaXNfdmFyYXJnKCkgdGhlbgogICAgICAgICAgICAgICAgICAgIGlzX3ZhcmFyZyA9IHRydWUKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBoYXNfYXJndW1lbnQgPSB0cnVlCiAgICAgICAgICAgICAgICBhcmd1bWVudF90b19tdXRleGVzW2VsZW1lbnRdID0gYXJndW1lbnRfdG9fbXV0ZXhlc1tlbGVtZW50XSBvciB7fQogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGFyZ3VtZW50X3RvX211dGV4ZXNbZWxlbWVudF0sIG11dGV4KQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIGVsZW1lbnRzX2luX211dGV4ZXNbZWxlbWVudF0gPSB0cnVlCiAgICAgICAgZW5kCgogICAgICAgIGlmIG5vdCBpc192YXJhcmcgYW5kIG5vdCBoYXNfYXJndW1lbnQgdGhlbgogICAgICAgICAgICBhZGRfbXV0ZXgobXV0ZXgpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgXywgb3B0aW9uIGluIGlwYWlycyhzZWxmLl9vcHRpb25zKSBkbwogICAgICAgIGlmIG5vdCBlbGVtZW50c19pbl9tdXRleGVzW29wdGlvbl0gYW5kIG5vdCBvcHRpb246X2lzX3ZhcmFyZygpIHRoZW4KICAgICAgICAgICAgYWRkX2VsZW1lbnQob3B0aW9uKQogICAgICAgIGVuZAogICAgZW5kCgogICAgLS0gQWRkIHVzYWdlcyBmb3IgcG9zaXRpb25hbCBhcmd1bWVudHMsIHRvZ2V0aGVyIHdpdGggb25lIG11dGV4IGNvbnRhaW5pbmcgdGhlbSwgaWYgdGhleSBhcmUgaW4gYSBtdXRleC4KICAgIGZvciBfLCBhcmd1bWVudCBpbiBpcGFpcnMoc2VsZi5fYXJndW1lbnRzKSBkbwogICAgICAgIC0tIFBpY2sgYSBtdXRleCBhcyBhIHBhcnQgb2Ygd2hpY2ggdG8gc2hvdyB0aGlzIGFyZ3VtZW50LCB0YWtlIHRoZSBmaXJzdCBvbmUgdGhhdCdzIHN0aWxsIGF2YWlsYWJsZS4KICAgICAgICBsb2NhbCBtdXRleAoKICAgICAgICBpZiBlbGVtZW50c19pbl9tdXRleGVzW2FyZ3VtZW50XSB0aGVuCiAgICAgICAgICAgIGZvciBfLCBhcmd1bWVudF9tdXRleCBpbiBpcGFpcnMoYXJndW1lbnRfdG9fbXV0ZXhlc1thcmd1bWVudF0pIGRvCiAgICAgICAgICAgICAgICBpZiBub3QgYWRkZWRfbXV0ZXhlc1thcmd1bWVudF9tdXRleF0gdGhlbgogICAgICAgICAgICAgICAgICAgIG11dGV4ID0gYXJndW1lbnRfbXV0ZXgKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgbXV0ZXggdGhlbgogICAgICAgICAgICBhZGRfbXV0ZXgobXV0ZXgsIGFyZ3VtZW50KQogICAgICAgIGVsc2UKICAgICAgICAgICAgYWRkX2VsZW1lbnQoYXJndW1lbnQpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgXywgbXV0ZXggaW4gaXBhaXJzKHNlbGYuX211dGV4ZXMpIGRvCiAgICAgICAgYWRkX211dGV4KG11dGV4KQogICAgZW5kCgogICAgZm9yIF8sIG9wdGlvbiBpbiBpcGFpcnMoc2VsZi5fb3B0aW9ucykgZG8KICAgICAgICBhZGRfZWxlbWVudChvcHRpb24pCiAgICBlbmQKCiAgICBpZiAjc2VsZi5fY29tbWFuZHMgPiAwIHRoZW4KICAgICAgICBpZiBzZWxmLl9yZXF1aXJlX2NvbW1hbmQgdGhlbgogICAgICAgICAgICBhZGQoIjxjb21tYW5kPiIpCiAgICAgICAgZWxzZQogICAgICAgICAgICBhZGQoIls8Y29tbWFuZD5dIikKICAgICAgICBlbmQKCiAgICAgICAgYWRkKCIuLi4iKQogICAgZW5kCgogICAgcmV0dXJuIHRhYmxlLmNvbmNhdChsaW5lcywgIlxuIikKZW5kCgpsb2NhbCBmdW5jdGlvbiBzcGxpdF9saW5lcyhzKQogICAgaWYgcyA9PSAiIiB0aGVuCiAgICAgICAgcmV0dXJuIHt9CiAgICBlbmQKCiAgICBsb2NhbCBsaW5lcyA9IHt9CgogICAgaWYgczpzdWIoLTEpIH49ICJcbiIgdGhlbgogICAgICAgIHMgPSBzIC4uICJcbiIKICAgIGVuZAoKICAgIGZvciBsaW5lIGluIHM6Z21hdGNoKCIoW15cbl0qKVxuIikgZG8KICAgICAgICB0YWJsZS5pbnNlcnQobGluZXMsIGxpbmUpCiAgICBlbmQKCiAgICByZXR1cm4gbGluZXMKZW5kCgpsb2NhbCBmdW5jdGlvbiBhdXRvd3JhcF9saW5lKGxpbmUsIG1heF9sZW5ndGgpCiAgICAtLSBBbGdvcml0aG0gZm9yIHNwbGl0dGluZyBsaW5lcyBpcyBzaW1wbGUgYW5kIGdyZWVkeS4KICAgIGxvY2FsIHJlc3VsdF9saW5lcyA9IHt9CgogICAgLS0gUHJlc2VydmUgb3JpZ2luYWwgaW5kZW50YXRpb24gb2YgdGhlIGxpbmUsIHB1dCB0aGlzIGF0IHRoZSBiZWdpbm5pbmcgb2YgZWFjaCByZXN1bHQgbGluZS4KICAgIC0tIElmIHRoZSBmaXJzdCB3b3JkIGxvb2tzIGxpa2UgYSBsaXN0IG1hcmtlciAoJyonLCAnKycsIG9yICctJyksIGFkZCBzcGFjZXMgc28gdGhhdCBzdGFydHMKICAgIC0tIG9mIHRoZSBzZWNvbmQgYW5kIHRoZSBmb2xsb3dpbmcgbGluZXMgdmVydGljYWxseSBhbGlnbiB3aXRoIHRoZSBzdGFydCBvZiB0aGUgc2Vjb25kIHdvcmQuCiAgICBsb2NhbCBpbmRlbnRhdGlvbiA9IGxpbmU6bWF0Y2goIl4gKiIpCgogICAgaWYgbGluZTpmaW5kKCJeICpbJSolKyUtXSIpIHRoZW4KICAgICAgICBpbmRlbnRhdGlvbiA9IGluZGVudGF0aW9uIC4uICIgIiAuLiBsaW5lOm1hdGNoKCJeICpbJSolKyUtXSggKikiKQogICAgZW5kCgogICAgLS0gUGFydHMgb2YgdGhlIGxhc3QgbGluZSBiZWluZyBhc3NlbWJsZWQuCiAgICBsb2NhbCBsaW5lX3BhcnRzID0ge30KCiAgICAtLSBMZW5ndGggb2YgdGhlIGN1cnJlbnQgbGluZS4KICAgIGxvY2FsIGxpbmVfbGVuZ3RoID0gMAoKICAgIC0tIEluZGV4IG9mIHRoZSBuZXh0IGNoYXJhY3RlciB0byBjb25zaWRlci4KICAgIGxvY2FsIGluZGV4ID0gMQoKICAgIHdoaWxlIHRydWUgZG8KICAgICAgICBsb2NhbCB3b3JkX3N0YXJ0LCB3b3JkX2ZpbmlzaCwgd29yZCA9IGxpbmU6ZmluZCgiKFteIF0rKSIsIGluZGV4KQoKICAgICAgICBpZiBub3Qgd29yZF9zdGFydCB0aGVuCiAgICAgICAgICAgIC0tIElnbm9yZSB0cmFpbGluZyBzcGFjZXMsIGlmIGFueS4KICAgICAgICAgICAgYnJlYWsKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgcHJlY2VkaW5nX3NwYWNlcyA9IGxpbmU6c3ViKGluZGV4LCB3b3JkX3N0YXJ0IC0gMSkKICAgICAgICBpbmRleCA9IHdvcmRfZmluaXNoICsgMQoKICAgICAgICBpZiAoI2xpbmVfcGFydHMgPT0gMCkgb3IgKGxpbmVfbGVuZ3RoICsgI3ByZWNlZGluZ19zcGFjZXMgKyAjd29yZCA8PSBtYXhfbGVuZ3RoKSB0aGVuCiAgICAgICAgICAgIC0tIEVpdGhlciB0aGlzIGlzIHRoZSB2ZXJ5IGZpcnN0IHdvcmQgb3IgaXQgZml0cyBhcyBhbiBhZGRpdGlvbiB0byB0aGUgY3VycmVudCBsaW5lLCBhZGQgaXQuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChsaW5lX3BhcnRzLCBwcmVjZWRpbmdfc3BhY2VzKSAtLSBGb3IgdGhlIHZlcnkgZmlyc3Qgd29yZCB0aGlzIGFkZHMgdGhlIGluZGVudGF0aW9uLgogICAgICAgICAgICB0YWJsZS5pbnNlcnQobGluZV9wYXJ0cywgd29yZCkKICAgICAgICAgICAgbGluZV9sZW5ndGggPSBsaW5lX2xlbmd0aCArICNwcmVjZWRpbmdfc3BhY2VzICsgI3dvcmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIC0tIERvZXMgbm90IGZpdCwgZmluaXNoIGN1cnJlbnQgbGluZSBhbmQgcHV0IHRoZSB3b3JkIGludG8gYSBuZXcgb25lLgogICAgICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0X2xpbmVzLCB0YWJsZS5jb25jYXQobGluZV9wYXJ0cykpCiAgICAgICAgICAgIGxpbmVfcGFydHMgPSB7aW5kZW50YXRpb24sIHdvcmR9CiAgICAgICAgICAgIGxpbmVfbGVuZ3RoID0gI2luZGVudGF0aW9uICsgI3dvcmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmICNsaW5lX3BhcnRzID4gMCB0aGVuCiAgICAgICAgdGFibGUuaW5zZXJ0KHJlc3VsdF9saW5lcywgdGFibGUuY29uY2F0KGxpbmVfcGFydHMpKQogICAgZW5kCgogICAgaWYgI3Jlc3VsdF9saW5lcyA9PSAwIHRoZW4KICAgICAgICAtLSBQcmVzZXJ2ZSBlbXB0eSBsaW5lcy4KICAgICAgICByZXN1bHRfbGluZXNbMV0gPSAiIgogICAgZW5kCgogICAgcmV0dXJuIHJlc3VsdF9saW5lcwplbmQKCi0tIEF1dG9tYXRpY2FsbHkgd3JhcHMgbGluZXMgd2l0aGluIGdpdmVuIGFycmF5LAotLSBhdHRlbXB0aW5nIHRvIGxpbWl0IGxpbmUgbGVuZ3RoIHRvIGBtYXhfbGVuZ3RoYC4KLS0gRXhpc3RpbmcgbGluZSBzcGxpdHMgYXJlIHByZXNlcnZlZC4KbG9jYWwgZnVuY3Rpb24gYXV0b3dyYXAobGluZXMsIG1heF9sZW5ndGgpCiAgICBsb2NhbCByZXN1bHRfbGluZXMgPSB7fQoKICAgIGZvciBfLCBsaW5lIGluIGlwYWlycyhsaW5lcykgZG8KICAgICAgICBsb2NhbCBhdXRvd3JhcHBlZF9saW5lcyA9IGF1dG93cmFwX2xpbmUobGluZSwgbWF4X2xlbmd0aCkKCiAgICAgICAgZm9yIF8sIGF1dG93cmFwcGVkX2xpbmUgaW4gaXBhaXJzKGF1dG93cmFwcGVkX2xpbmVzKSBkbwogICAgICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0X2xpbmVzLCBhdXRvd3JhcHBlZF9saW5lKQogICAgICAgIGVuZAogICAgZW5kCgogICAgcmV0dXJuIHJlc3VsdF9saW5lcwplbmQKCmZ1bmN0aW9uIFBhcnNlcjpfZ2V0X2VsZW1lbnRfaGVscChlbGVtZW50KQogICAgbG9jYWwgbGFiZWxfbGluZXMgPSBlbGVtZW50Ol9nZXRfbGFiZWxfbGluZXMoKQogICAgbG9jYWwgZGVzY3JpcHRpb25fbGluZXMgPSBzcGxpdF9saW5lcyhlbGVtZW50Ol9nZXRfZGVzY3JpcHRpb24oKSkKCiAgICBsb2NhbCByZXN1bHRfbGluZXMgPSB7fQoKICAgIC0tIEFsbCBsYWJlbCBsaW5lcyBzaG91bGQgaGF2ZSB0aGUgc2FtZSBsZW5ndGggKGV4Y2VwdCB0aGUgbGFzdCBvbmUsIGl0IGhhcyBubyBjb21tYSkuCiAgICAtLSBJZiB0b28gbG9uZywgc3RhcnQgZGVzY3JpcHRpb24gYWZ0ZXIgYWxsIHRoZSBsYWJlbCBsaW5lcy4KICAgIC0tIE90aGVyd2lzZSwgY29tYmluZSBsYWJlbCBhbmQgZGVzY3JpcHRpb24gbGluZXMuCgogICAgbG9jYWwgdXNhZ2VfbWFyZ2luX2xlbiA9IHNlbGY6X2luaGVyaXRfcHJvcGVydHkoImhlbHBfdXNhZ2VfbWFyZ2luIiwgMykKICAgIGxvY2FsIHVzYWdlX21hcmdpbiA9ICgiICIpOnJlcCh1c2FnZV9tYXJnaW5fbGVuKQogICAgbG9jYWwgZGVzY3JpcHRpb25fbWFyZ2luX2xlbiA9IHNlbGY6X2luaGVyaXRfcHJvcGVydHkoImhlbHBfZGVzY3JpcHRpb25fbWFyZ2luIiwgMjUpCiAgICBsb2NhbCBkZXNjcmlwdGlvbl9tYXJnaW4gPSAoIiAiKTpyZXAoZGVzY3JpcHRpb25fbWFyZ2luX2xlbikKCiAgICBsb2NhbCBoZWxwX21heF93aWR0aCA9IHNlbGY6X2luaGVyaXRfcHJvcGVydHkoImhlbHBfbWF4X3dpZHRoIikKCiAgICBpZiBoZWxwX21heF93aWR0aCB0aGVuCiAgICAgICAgbG9jYWwgZGVzY3JpcHRpb25fbWF4X3dpZHRoID0gbWF0aC5tYXgoaGVscF9tYXhfd2lkdGggLSBkZXNjcmlwdGlvbl9tYXJnaW5fbGVuLCAxMCkKICAgICAgICBkZXNjcmlwdGlvbl9saW5lcyA9IGF1dG93cmFwKGRlc2NyaXB0aW9uX2xpbmVzLCBkZXNjcmlwdGlvbl9tYXhfd2lkdGgpCiAgICBlbmQKCiAgICBpZiAjbGFiZWxfbGluZXNbMV0gPj0gKGRlc2NyaXB0aW9uX21hcmdpbl9sZW4gLSB1c2FnZV9tYXJnaW5fbGVuKSB0aGVuCiAgICAgICAgZm9yIF8sIGxhYmVsX2xpbmUgaW4gaXBhaXJzKGxhYmVsX2xpbmVzKSBkbwogICAgICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0X2xpbmVzLCB1c2FnZV9tYXJnaW4gLi4gbGFiZWxfbGluZSkKICAgICAgICBlbmQKCiAgICAgICAgZm9yIF8sIGRlc2NyaXB0aW9uX2xpbmUgaW4gaXBhaXJzKGRlc2NyaXB0aW9uX2xpbmVzKSBkbwogICAgICAgICAgICB0YWJsZS5pbnNlcnQocmVzdWx0X2xpbmVzLCBkZXNjcmlwdGlvbl9tYXJnaW4gLi4gZGVzY3JpcHRpb25fbGluZSkKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBmb3IgaSA9IDEsIG1hdGgubWF4KCNsYWJlbF9saW5lcywgI2Rlc2NyaXB0aW9uX2xpbmVzKSBkbwogICAgICAgICAgICBsb2NhbCBsYWJlbF9saW5lID0gbGFiZWxfbGluZXNbaV0KICAgICAgICAgICAgbG9jYWwgZGVzY3JpcHRpb25fbGluZSA9IGRlc2NyaXB0aW9uX2xpbmVzW2ldCgogICAgICAgICAgICBsb2NhbCBsaW5lID0gIiIKCiAgICAgICAgICAgIGlmIGxhYmVsX2xpbmUgdGhlbgogICAgICAgICAgICAgICAgbGluZSA9IHVzYWdlX21hcmdpbiAuLiBsYWJlbF9saW5lCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgaWYgZGVzY3JpcHRpb25fbGluZSBhbmQgZGVzY3JpcHRpb25fbGluZSB+PSAiIiB0aGVuCiAgICAgICAgICAgICAgICBsaW5lID0gbGluZSAuLiAoIiAiKTpyZXAoZGVzY3JpcHRpb25fbWFyZ2luX2xlbiAtICNsaW5lKSAuLiBkZXNjcmlwdGlvbl9saW5lCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHJlc3VsdF9saW5lcywgbGluZSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHJldHVybiB0YWJsZS5jb25jYXQocmVzdWx0X2xpbmVzLCAiXG4iKQplbmQKCmxvY2FsIGZ1bmN0aW9uIGdldF9ncm91cF90eXBlcyhncm91cCkKICAgIGxvY2FsIHR5cGVzID0ge30KCiAgICBmb3IgXywgZWxlbWVudCBpbiBpcGFpcnMoZ3JvdXApIGRvCiAgICAgICAgdHlwZXNbZ2V0bWV0YXRhYmxlKGVsZW1lbnQpXSA9IHRydWUKICAgIGVuZAoKICAgIHJldHVybiB0eXBlcwplbmQKCmZ1bmN0aW9uIFBhcnNlcjpfYWRkX2dyb3VwX2hlbHAoYmxvY2tzLCBhZGRlZF9lbGVtZW50cywgbGFiZWwsIGVsZW1lbnRzKQogICAgbG9jYWwgYnVmID0ge2xhYmVsfQoKICAgIGZvciBfLCBlbGVtZW50IGluIGlwYWlycyhlbGVtZW50cykgZG8KICAgICAgICBpZiBub3QgZWxlbWVudC5faGlkZGVuIGFuZCBub3QgYWRkZWRfZWxlbWVudHNbZWxlbWVudF0gdGhlbgogICAgICAgICAgICBhZGRlZF9lbGVtZW50c1tlbGVtZW50XSA9IHRydWUKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGJ1Ziwgc2VsZjpfZ2V0X2VsZW1lbnRfaGVscChlbGVtZW50KSkKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGlmICNidWYgPiAxIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQoYmxvY2tzLCB0YWJsZS5jb25jYXQoYnVmLCAoIlxuIik6cmVwKHNlbGY6X2luaGVyaXRfcHJvcGVydHkoImhlbHBfdmVydGljYWxfc3BhY2UiLCAwKSArIDEpKSkKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFBhcnNlcjpnZXRfaGVscCgpCiAgICBpZiBzZWxmLl9oZWxwIHRoZW4KICAgICAgICByZXR1cm4gc2VsZi5faGVscAogICAgZW5kCgogICAgbG9jYWwgYmxvY2tzID0ge3NlbGY6Z2V0X3VzYWdlKCl9CgogICAgbG9jYWwgaGVscF9tYXhfd2lkdGggPSBzZWxmOl9pbmhlcml0X3Byb3BlcnR5KCJoZWxwX21heF93aWR0aCIpCgogICAgaWYgc2VsZi5fZGVzY3JpcHRpb24gdGhlbgogICAgICAgIGxvY2FsIGRlc2NyaXB0aW9uID0gc2VsZi5fZGVzY3JpcHRpb24KCiAgICAgICAgaWYgaGVscF9tYXhfd2lkdGggdGhlbgogICAgICAgICAgICBkZXNjcmlwdGlvbiA9IHRhYmxlLmNvbmNhdChhdXRvd3JhcChzcGxpdF9saW5lcyhkZXNjcmlwdGlvbiksIGhlbHBfbWF4X3dpZHRoKSwgIlxuIikKICAgICAgICBlbmQKCiAgICAgICAgdGFibGUuaW5zZXJ0KGJsb2NrcywgZGVzY3JpcHRpb24pCiAgICBlbmQKCiAgICAtLSAxLiBQdXQgZ3JvdXBzIGNvbnRhaW5pbmcgYXJndW1lbnRzIGZpcnN0LCB0aGVuIG90aGVyIGFyZ3VtZW50cy4KICAgIC0tIDIuIFB1dCByZW1haW5pbmcgZ3JvdXBzIGNvbnRhaW5pbmcgb3B0aW9ucywgdGhlbiBvdGhlciBvcHRpb25zLgogICAgLS0gMy4gUHV0IHJlbWFpbmluZyBncm91cHMgY29udGFpbmluZyBjb21tYW5kcywgdGhlbiBvdGhlciBjb21tYW5kcy4KICAgIC0tIEFzc3VtZSB0aGF0IGFuIGVsZW1lbnQgY2FuJ3QgYmUgaW4gc2V2ZXJhbCBncm91cHMuCiAgICBsb2NhbCBncm91cHNfYnlfdHlwZSA9IHsKICAgICAgICBbQXJndW1lbnRdID0ge30sCiAgICAgICAgW09wdGlvbl0gPSB7fSwKICAgICAgICBbQ29tbWFuZF0gPSB7fQogICAgfQoKICAgIGZvciBfLCBncm91cCBpbiBpcGFpcnMoc2VsZi5fZ3JvdXBzKSBkbwogICAgICAgIGxvY2FsIGdyb3VwX3R5cGVzID0gZ2V0X2dyb3VwX3R5cGVzKGdyb3VwKQoKICAgICAgICBmb3IgXywgbXQgaW4gaXBhaXJzKHtBcmd1bWVudCwgT3B0aW9uLCBDb21tYW5kfSkgZG8KICAgICAgICAgICAgaWYgZ3JvdXBfdHlwZXNbbXRdIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChncm91cHNfYnlfdHlwZVttdF0sIGdyb3VwKQogICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBsb2NhbCBkZWZhdWx0X2dyb3VwcyA9IHsKICAgICAgICB7bmFtZSA9ICJBcmd1bWVudHMiLCB0eXBlID0gQXJndW1lbnQsIGVsZW1lbnRzID0gc2VsZi5fYXJndW1lbnRzfSwKICAgICAgICB7bmFtZSA9ICJPcHRpb25zIiwgdHlwZSA9IE9wdGlvbiwgZWxlbWVudHMgPSBzZWxmLl9vcHRpb25zfSwKICAgICAgICB7bmFtZSA9ICJDb21tYW5kcyIsIHR5cGUgPSBDb21tYW5kLCBlbGVtZW50cyA9IHNlbGYuX2NvbW1hbmRzfQogICAgfQoKICAgIGxvY2FsIGFkZGVkX2VsZW1lbnRzID0ge30KCiAgICBmb3IgXywgZGVmYXVsdF9ncm91cCBpbiBpcGFpcnMoZGVmYXVsdF9ncm91cHMpIGRvCiAgICAgICAgbG9jYWwgdHlwZV9ncm91cHMgPSBncm91cHNfYnlfdHlwZVtkZWZhdWx0X2dyb3VwLnR5cGVdCgogICAgICAgIGZvciBfLCBncm91cCBpbiBpcGFpcnModHlwZV9ncm91cHMpIGRvCiAgICAgICAgICAgIHNlbGY6X2FkZF9ncm91cF9oZWxwKGJsb2NrcywgYWRkZWRfZWxlbWVudHMsIGdyb3VwLm5hbWUgLi4gIjoiLCBncm91cCkKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgZGVmYXVsdF9sYWJlbCA9IGRlZmF1bHRfZ3JvdXAubmFtZSAuLiAiOiIKCiAgICAgICAgaWYgI3R5cGVfZ3JvdXBzID4gMCB0aGVuCiAgICAgICAgICAgIGRlZmF1bHRfbGFiZWwgPSAiT3RoZXIgIiAuLiBkZWZhdWx0X2xhYmVsOmdzdWIoIl4uIiwgc3RyaW5nLmxvd2VyKQogICAgICAgIGVuZAoKICAgICAgICBzZWxmOl9hZGRfZ3JvdXBfaGVscChibG9ja3MsIGFkZGVkX2VsZW1lbnRzLCBkZWZhdWx0X2xhYmVsLCBkZWZhdWx0X2dyb3VwLmVsZW1lbnRzKQogICAgZW5kCgogICAgaWYgc2VsZi5fZXBpbG9nIHRoZW4KICAgICAgICBsb2NhbCBlcGlsb2cgPSBzZWxmLl9lcGlsb2cKCiAgICAgICAgaWYgaGVscF9tYXhfd2lkdGggdGhlbgogICAgICAgICAgICBlcGlsb2cgPSB0YWJsZS5jb25jYXQoYXV0b3dyYXAoc3BsaXRfbGluZXMoZXBpbG9nKSwgaGVscF9tYXhfd2lkdGgpLCAiXG4iKQogICAgICAgIGVuZAoKICAgICAgICB0YWJsZS5pbnNlcnQoYmxvY2tzLCBlcGlsb2cpCiAgICBlbmQKCiAgICByZXR1cm4gdGFibGUuY29uY2F0KGJsb2NrcywgIlxuXG4iKQplbmQKCmZ1bmN0aW9uIFBhcnNlcjphZGRfaGVscF9jb21tYW5kKHZhbHVlKQogICAgaWYgdmFsdWUgdGhlbgogICAgICAgIGFzc2VydCh0eXBlKHZhbHVlKSA9PSAic3RyaW5nIiBvciB0eXBlKHZhbHVlKSA9PSAidGFibGUiLAogICAgICAgICAgICAgICAgKCJiYWQgYXJndW1lbnQgIzEgdG8gJ2FkZF9oZWxwX2NvbW1hbmQnIChzdHJpbmcgb3IgdGFibGUgZXhwZWN0ZWQsIGdvdCAlcykiKTpmb3JtYXQodHlwZSh2YWx1ZSkpKQogICAgZW5kCgogICAgbG9jYWwgaGVscCA9IHNlbGY6Y29tbWFuZCgpCiAgICAgICAgICAgICAgICAgICAgIDpkZXNjcmlwdGlvbiAiU2hvdyBoZWxwIGZvciBjb21tYW5kcy4iCiAgICBoZWxwOmFyZ3VtZW50ICJjb21tYW5kIgogICAgICAgIDpkZXNjcmlwdGlvbiAiVGhlIGNvbW1hbmQgdG8gc2hvdyBoZWxwIGZvci4iCiAgICAgICAgOmFyZ3MgIj8iCiAgICAgICAgOmFjdGlvbihmdW5jdGlvbihfLCBfLCBjbWQpCiAgICAgICAgaWYgbm90IGNtZCB0aGVuCiAgICAgICAgICAgIHByaW50KHNlbGY6Z2V0X2hlbHAoKSkKICAgICAgICAgICAgb3MuZXhpdCgwKQogICAgICAgIGVsc2UKICAgICAgICAgICAgZm9yIF8sIGNvbW1hbmQgaW4gaXBhaXJzKHNlbGYuX2NvbW1hbmRzKSBkbwogICAgICAgICAgICAgICAgZm9yIF8sIGFsaWFzIGluIGlwYWlycyhjb21tYW5kLl9hbGlhc2VzKSBkbwogICAgICAgICAgICAgICAgICAgIGlmIGFsaWFzID09IGNtZCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGNvbW1hbmQ6Z2V0X2hlbHAoKSkKICAgICAgICAgICAgICAgICAgICAgICAgb3MuZXhpdCgwKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGhlbHA6ZXJyb3IoKCJ1bmtub3duIGNvbW1hbmQgJyVzJyIpOmZvcm1hdChjbWQpKQogICAgZW5kKQoKICAgIGlmIHZhbHVlIHRoZW4KICAgICAgICBoZWxwID0gaGVscCh2YWx1ZSkKICAgIGVuZAoKICAgIGlmIG5vdCBoZWxwLl9uYW1lIHRoZW4KICAgICAgICBoZWxwICJoZWxwIgogICAgZW5kCgogICAgaGVscC5faXNfaGVscF9jb21tYW5kID0gdHJ1ZQogICAgcmV0dXJuIHNlbGYKZW5kCgpmdW5jdGlvbiBQYXJzZXI6X2lzX3NoZWxsX3NhZmUoKQogICAgaWYgc2VsZi5fYmFzZW5hbWUgdGhlbgogICAgICAgIGlmIHNlbGYuX2Jhc2VuYW1lOmZpbmQoIlteJXdfJS0lKyUuXSIpIHRoZW4KICAgICAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgZm9yIF8sIGFsaWFzIGluIGlwYWlycyhzZWxmLl9hbGlhc2VzKSBkbwogICAgICAgICAgICBpZiBhbGlhczpmaW5kKCJbXiV3XyUtJSslLl0iKSB0aGVuCiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIGZvciBfLCBvcHRpb24gaW4gaXBhaXJzKHNlbGYuX29wdGlvbnMpIGRvCiAgICAgICAgZm9yIF8sIGFsaWFzIGluIGlwYWlycyhvcHRpb24uX2FsaWFzZXMpIGRvCiAgICAgICAgICAgIGlmIGFsaWFzOmZpbmQoIlteJXdfJS0lKyUuXSIpIHRoZW4KICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICBpZiBvcHRpb24uX2Nob2ljZXMgdGhlbgogICAgICAgICAgICBmb3IgXywgY2hvaWNlIGluIGlwYWlycyhvcHRpb24uX2Nob2ljZXMpIGRvCiAgICAgICAgICAgICAgICBpZiBjaG9pY2U6ZmluZCgiWyVzJ1wiXSIpIHRoZW4KICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAogICAgZm9yIF8sIGFyZ3VtZW50IGluIGlwYWlycyhzZWxmLl9hcmd1bWVudHMpIGRvCiAgICAgICAgaWYgYXJndW1lbnQuX2Nob2ljZXMgdGhlbgogICAgICAgICAgICBmb3IgXywgY2hvaWNlIGluIGlwYWlycyhhcmd1bWVudC5fY2hvaWNlcykgZG8KICAgICAgICAgICAgICAgIGlmIGNob2ljZTpmaW5kKCJbJXMnXCJdIikgdGhlbgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCiAgICBmb3IgXywgY29tbWFuZCBpbiBpcGFpcnMoc2VsZi5fY29tbWFuZHMpIGRvCiAgICAgICAgaWYgbm90IGNvbW1hbmQ6X2lzX3NoZWxsX3NhZmUoKSB0aGVuCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCiAgICByZXR1cm4gdHJ1ZQplbmQKCmZ1bmN0aW9uIFBhcnNlcjphZGRfY29tcGxldGUodmFsdWUpCiAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgYXNzZXJ0KHR5cGUodmFsdWUpID09ICJzdHJpbmciIG9yIHR5cGUodmFsdWUpID09ICJ0YWJsZSIsCiAgICAgICAgICAgICAgICAoImJhZCBhcmd1bWVudCAjMSB0byAnYWRkX2NvbXBsZXRlJyAoc3RyaW5nIG9yIHRhYmxlIGV4cGVjdGVkLCBnb3QgJXMpIik6Zm9ybWF0KHR5cGUodmFsdWUpKSkKICAgIGVuZAoKICAgIGxvY2FsIGNvbXBsZXRlID0gc2VsZjpvcHRpb24oKQogICAgICAgICAgICAgICAgICAgICAgICAgOmRlc2NyaXB0aW9uICJPdXRwdXQgYSBzaGVsbCBjb21wbGV0aW9uIHNjcmlwdCBmb3IgdGhlIHNwZWNpZmllZCBzaGVsbC4iCiAgICAgICAgICAgICAgICAgICAgICAgICA6YXJncygxKQogICAgICAgICAgICAgICAgICAgICAgICAgOmNob2ljZXMgeyJiYXNoIiwgInpzaCIsICJmaXNoIn0KICAgICAgICAgICAgICAgICAgICAgICAgIDphY3Rpb24oZnVuY3Rpb24oXywgXywgc2hlbGwpCiAgICAgICAgaW8ud3JpdGUoc2VsZlsiZ2V0XyIgLi4gc2hlbGwgLi4gIl9jb21wbGV0ZSJdKHNlbGYpKQogICAgICAgIG9zLmV4aXQoMCkKICAgIGVuZCkKCiAgICBpZiB2YWx1ZSB0aGVuCiAgICAgICAgY29tcGxldGUgPSBjb21wbGV0ZSh2YWx1ZSkKICAgIGVuZAoKICAgIGlmIG5vdCBjb21wbGV0ZS5fbmFtZSB0aGVuCiAgICAgICAgY29tcGxldGUgIi0tY29tcGxldGlvbiIKICAgIGVuZAoKICAgIHJldHVybiBzZWxmCmVuZAoKZnVuY3Rpb24gUGFyc2VyOmFkZF9jb21wbGV0ZV9jb21tYW5kKHZhbHVlKQogICAgaWYgdmFsdWUgdGhlbgogICAgICAgIGFzc2VydCh0eXBlKHZhbHVlKSA9PSAic3RyaW5nIiBvciB0eXBlKHZhbHVlKSA9PSAidGFibGUiLAogICAgICAgICAgICAgICAgKCJiYWQgYXJndW1lbnQgIzEgdG8gJ2FkZF9jb21wbGV0ZV9jb21tYW5kJyAoc3RyaW5nIG9yIHRhYmxlIGV4cGVjdGVkLCBnb3QgJXMpIik6Zm9ybWF0KHR5cGUodmFsdWUpKSkKICAgIGVuZAoKICAgIGxvY2FsIGNvbXBsZXRlID0gc2VsZjpjb21tYW5kKCkKICAgICAgICAgICAgICAgICAgICAgICAgIDpkZXNjcmlwdGlvbiAiT3V0cHV0IGEgc2hlbGwgY29tcGxldGlvbiBzY3JpcHQuIgogICAgY29tcGxldGU6YXJndW1lbnQgInNoZWxsIgogICAgICAgICAgICA6ZGVzY3JpcHRpb24gIlRoZSBzaGVsbCB0byBvdXRwdXQgYSBjb21wbGV0aW9uIHNjcmlwdCBmb3IuIgogICAgICAgICAgICA6Y2hvaWNlcyB7ImJhc2giLCAienNoIiwgImZpc2gifQogICAgICAgICAgICA6YWN0aW9uKGZ1bmN0aW9uKF8sIF8sIHNoZWxsKQogICAgICAgIGlvLndyaXRlKHNlbGZbImdldF8iIC4uIHNoZWxsIC4uICJfY29tcGxldGUiXShzZWxmKSkKICAgICAgICBvcy5leGl0KDApCiAgICBlbmQpCgogICAgaWYgdmFsdWUgdGhlbgogICAgICAgIGNvbXBsZXRlID0gY29tcGxldGUodmFsdWUpCiAgICBlbmQKCiAgICBpZiBub3QgY29tcGxldGUuX25hbWUgdGhlbgogICAgICAgIGNvbXBsZXRlICJjb21wbGV0aW9uIgogICAgZW5kCgogICAgcmV0dXJuIHNlbGYKZW5kCgpsb2NhbCBmdW5jdGlvbiBiYXNlX25hbWUocGF0aG5hbWUpCiAgICByZXR1cm4gcGF0aG5hbWU6Z3N1YigiWy9cXF0qJCIsICIiKTptYXRjaCgiLipbL1xcXShbXi9cXF0qKSIpIG9yIHBhdGhuYW1lCmVuZAoKbG9jYWwgZnVuY3Rpb24gZ2V0X3Nob3J0X2Rlc2NyaXB0aW9uKGVsZW1lbnQpCiAgICBsb2NhbCBzaG9ydCA9IGVsZW1lbnQ6X2dldF9kZXNjcmlwdGlvbigpOm1hdGNoKCJeKC4tKSUuJXMiKQogICAgcmV0dXJuIHNob3J0IG9yIGVsZW1lbnQ6X2dldF9kZXNjcmlwdGlvbigpOm1hdGNoKCJeKC4tKSUuPyQiKQplbmQKCmZ1bmN0aW9uIFBhcnNlcjpfZ2V0X29wdGlvbnMoKQogICAgbG9jYWwgb3B0aW9ucyA9IHt9CiAgICBmb3IgXywgb3B0aW9uIGluIGlwYWlycyhzZWxmLl9vcHRpb25zKSBkbwogICAgICAgIGZvciBfLCBhbGlhcyBpbiBpcGFpcnMob3B0aW9uLl9hbGlhc2VzKSBkbwogICAgICAgICAgICB0YWJsZS5pbnNlcnQob3B0aW9ucywgYWxpYXMpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiB0YWJsZS5jb25jYXQob3B0aW9ucywgIiAiKQplbmQKCmZ1bmN0aW9uIFBhcnNlcjpfZ2V0X2NvbW1hbmRzKCkKICAgIGxvY2FsIGNvbW1hbmRzID0ge30KICAgIGZvciBfLCBjb21tYW5kIGluIGlwYWlycyhzZWxmLl9jb21tYW5kcykgZG8KICAgICAgICBmb3IgXywgYWxpYXMgaW4gaXBhaXJzKGNvbW1hbmQuX2FsaWFzZXMpIGRvCiAgICAgICAgICAgIHRhYmxlLmluc2VydChjb21tYW5kcywgYWxpYXMpCiAgICAgICAgZW5kCiAgICBlbmQKICAgIHJldHVybiB0YWJsZS5jb25jYXQoY29tbWFuZHMsICIgIikKZW5kCgpmdW5jdGlvbiBQYXJzZXI6X2Jhc2hfb3B0aW9uX2FyZ3MoYnVmLCBpbmRlbnQpCiAgICBsb2NhbCBvcHRzID0ge30KICAgIGZvciBfLCBvcHRpb24gaW4gaXBhaXJzKHNlbGYuX29wdGlvbnMpIGRvCiAgICAgICAgaWYgb3B0aW9uLl9jaG9pY2VzIG9yIG9wdGlvbi5fbWluYXJncyA+IDAgdGhlbgogICAgICAgICAgICBsb2NhbCBjb21wcmVwbHkKICAgICAgICAgICAgaWYgb3B0aW9uLl9jaG9pY2VzIHRoZW4KICAgICAgICAgICAgICAgIGNvbXByZXBseSA9ICdDT01QUkVQTFk9KCQoY29tcGdlbiAtVyAiJyAuLiB0YWJsZS5jb25jYXQob3B0aW9uLl9jaG9pY2VzLCAiICIpIC4uICciIC0tICIkY3VyIikpJwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBjb21wcmVwbHkgPSAnQ09NUFJFUExZPSgkKGNvbXBnZW4gLWYgLS0gIiRjdXIiKSknCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YWJsZS5pbnNlcnQob3B0cywgKCIgIik6cmVwKGluZGVudCArIDQpIC4uIHRhYmxlLmNvbmNhdChvcHRpb24uX2FsaWFzZXMsICJ8IikgLi4gIikiKQogICAgICAgICAgICB0YWJsZS5pbnNlcnQob3B0cywgKCIgIik6cmVwKGluZGVudCArIDgpIC4uIGNvbXByZXBseSkKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KG9wdHMsICgiICIpOnJlcChpbmRlbnQgKyA4KSAuLiAicmV0dXJuIDAiKQogICAgICAgICAgICB0YWJsZS5pbnNlcnQob3B0cywgKCIgIik6cmVwKGluZGVudCArIDgpIC4uICI7OyIpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiAjb3B0cyA+IDAgdGhlbgogICAgICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQpIC4uICdjYXNlICIkcHJldiIgaW4nKQogICAgICAgIHRhYmxlLmluc2VydChidWYsIHRhYmxlLmNvbmNhdChvcHRzLCAiXG4iKSkKICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50KSAuLiAiZXNhY1xuIikKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFBhcnNlcjpfYmFzaF9nZXRfY21kKGJ1ZiwgaW5kZW50KQogICAgaWYgI3NlbGYuX2NvbW1hbmRzID09IDAgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCkgLi4gJ2FyZ3M9KCIke2FyZ3NbQF06MX0iKScpCiAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50KSAuLiAnZm9yIGFyZyBpbiAiJHthcmdzW0BdfSI7IGRvJykKICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyA0KSAuLiAnY2FzZSAiJGFyZyIgaW4nKQoKICAgIGZvciBfLCBjb21tYW5kIGluIGlwYWlycyhzZWxmLl9jb21tYW5kcykgZG8KICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50ICsgOCkgLi4gdGFibGUuY29uY2F0KGNvbW1hbmQuX2FsaWFzZXMsICJ8IikgLi4gIikiKQogICAgICAgIGlmIHNlbGYuX3BhcmVudCB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyAxMikgLi4gJ2NtZD0iJGNtZCAnIC4uIGNvbW1hbmQuX25hbWUgLi4gJyInKQogICAgICAgIGVsc2UKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCArIDEyKSAuLiAnY21kPSInIC4uIGNvbW1hbmQuX25hbWUgLi4gJyInKQogICAgICAgIGVuZAogICAgICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyAxMikgLi4gJ29wdHM9IiRvcHRzICcgLi4gY29tbWFuZDpfZ2V0X29wdGlvbnMoKSAuLiAnIicpCiAgICAgICAgY29tbWFuZDpfYmFzaF9nZXRfY21kKGJ1ZiwgaW5kZW50ICsgMTIpCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCArIDEyKSAuLiAiYnJlYWsiKQogICAgICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyAxMikgLi4gIjs7IikKICAgIGVuZAoKICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyA0KSAuLiAiZXNhYyIpCiAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50KSAuLiAiZG9uZSIpCmVuZAoKZnVuY3Rpb24gUGFyc2VyOl9iYXNoX2NtZF9jb21wbGV0aW9ucyhidWYpCiAgICBsb2NhbCBjbWRfYnVmID0ge30KICAgIGlmIHNlbGYuX3BhcmVudCB0aGVuCiAgICAgICAgc2VsZjpfYmFzaF9vcHRpb25fYXJncyhjbWRfYnVmLCAxMikKICAgIGVuZAogICAgaWYgI3NlbGYuX2NvbW1hbmRzID4gMCB0aGVuCiAgICAgICAgdGFibGUuaW5zZXJ0KGNtZF9idWYsICgiICIpOnJlcCgxMikgLi4gJ0NPTVBSRVBMWT0oJChjb21wZ2VuIC1XICInIC4uIHNlbGY6X2dldF9jb21tYW5kcygpIC4uICciIC0tICIkY3VyIikpJykKICAgIGVsc2VpZiBzZWxmLl9pc19oZWxwX2NvbW1hbmQgdGhlbgogICAgICAgIHRhYmxlLmluc2VydChjbWRfYnVmLCAoIiAiKTpyZXAoMTIpCiAgICAgICAgICAgICAgICAuLiAnQ09NUFJFUExZPSgkKGNvbXBnZW4gLVcgIicKICAgICAgICAgICAgICAgIC4uIHNlbGYuX3BhcmVudDpfZ2V0X2NvbW1hbmRzKCkKICAgICAgICAgICAgICAgIC4uICciIC0tICIkY3VyIikpJykKICAgIGVuZAogICAgaWYgI2NtZF9idWYgPiAwIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoOCkgLi4gIiciIC4uIHNlbGY6X2dldF9mdWxsbmFtZSh0cnVlKSAuLiAiJykiKQogICAgICAgIHRhYmxlLmluc2VydChidWYsIHRhYmxlLmNvbmNhdChjbWRfYnVmLCAiXG4iKSkKICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoMTIpIC4uICI7OyIpCiAgICBlbmQKCiAgICBmb3IgXywgY29tbWFuZCBpbiBpcGFpcnMoc2VsZi5fY29tbWFuZHMpIGRvCiAgICAgICAgY29tbWFuZDpfYmFzaF9jbWRfY29tcGxldGlvbnMoYnVmKQogICAgZW5kCmVuZAoKZnVuY3Rpb24gUGFyc2VyOmdldF9iYXNoX2NvbXBsZXRlKCkKICAgIHNlbGYuX2Jhc2VuYW1lID0gYmFzZV9uYW1lKHNlbGYuX25hbWUpCiAgICBhc3NlcnQoc2VsZjpfaXNfc2hlbGxfc2FmZSgpKQogICAgbG9jYWwgYnVmID0geyhbWwpfJXMoKSB7CiAgICBsb2NhbCBJRlM9JCcgXHRcbicKICAgIGxvY2FsIGFyZ3MgY3VyIHByZXYgY21kIG9wdHMgYXJnCiAgICBhcmdzPSgiJHtDT01QX1dPUkRTW0BdfSIpCiAgICBjdXI9IiR7Q09NUF9XT1JEU1tDT01QX0NXT1JEXX0iCiAgICBwcmV2PSIke0NPTVBfV09SRFNbQ09NUF9DV09SRC0xXX0iCiAgICBvcHRzPSIlcyIKXV0pOmZvcm1hdChzZWxmLl9iYXNlbmFtZSwgc2VsZjpfZ2V0X29wdGlvbnMoKSl9CgogICAgc2VsZjpfYmFzaF9vcHRpb25fYXJncyhidWYsIDQpCiAgICBzZWxmOl9iYXNoX2dldF9jbWQoYnVmLCA0KQogICAgaWYgI3NlbGYuX2NvbW1hbmRzID4gMCB0aGVuCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgIiIpCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKDQpIC4uICdjYXNlICIkY21kIiBpbicpCiAgICAgICAgc2VsZjpfYmFzaF9jbWRfY29tcGxldGlvbnMoYnVmKQogICAgICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcCg0KSAuLiAiZXNhY1xuIikKICAgIGVuZAoKICAgIHRhYmxlLmluc2VydChidWYsIChbPVsKICAgIGlmIFtbICIkY3VyIiA9IC0qIF1dOyB0aGVuCiAgICAgICAgQ09NUFJFUExZPSgkKGNvbXBnZW4gLVcgIiRvcHRzIiAtLSAiJGN1ciIpKQogICAgZmkKfQoKY29tcGxldGUgLUYgXyVzIC1vIGJhc2hkZWZhdWx0IC1vIGRlZmF1bHQgJXMKXT1dKTpmb3JtYXQoc2VsZi5fYmFzZW5hbWUsIHNlbGYuX2Jhc2VuYW1lKSkKCiAgICByZXR1cm4gdGFibGUuY29uY2F0KGJ1ZiwgIlxuIikKZW5kCgpmdW5jdGlvbiBQYXJzZXI6X3pzaF9hcmd1bWVudHMoYnVmLCBjbWRfbmFtZSwgaW5kZW50KQogICAgaWYgc2VsZi5fcGFyZW50IHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50KSAuLiAib3B0aW9ucz0oIikKICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50ICsgMikgLi4gIiRvcHRpb25zIikKICAgIGVsc2UKICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50KSAuLiAibG9jYWwgLWEgb3B0aW9ucz0oIikKICAgIGVuZAoKICAgIGZvciBfLCBvcHRpb24gaW4gaXBhaXJzKHNlbGYuX29wdGlvbnMpIGRvCiAgICAgICAgbG9jYWwgbGluZSA9IHt9CiAgICAgICAgaWYgI29wdGlvbi5fYWxpYXNlcyA+IDEgdGhlbgogICAgICAgICAgICBpZiBvcHRpb24uX21heGNvdW50ID4gMSB0aGVuCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQobGluZSwgJyIqIicpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YWJsZS5pbnNlcnQobGluZSwgInsiIC4uIHRhYmxlLmNvbmNhdChvcHRpb24uX2FsaWFzZXMsICIsIikgLi4gJ30iJykKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRhYmxlLmluc2VydChsaW5lLCAnIicpCiAgICAgICAgICAgIGlmIG9wdGlvbi5fbWF4Y291bnQgPiAxIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChsaW5lLCAiKiIpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICB0YWJsZS5pbnNlcnQobGluZSwgb3B0aW9uLl9uYW1lKQogICAgICAgIGVuZAogICAgICAgIGlmIG9wdGlvbi5fZGVzY3JpcHRpb24gdGhlbgogICAgICAgICAgICBsb2NhbCBkZXNjcmlwdGlvbiA9IGdldF9zaG9ydF9kZXNjcmlwdGlvbihvcHRpb24pOmdzdWIoJ1siJV06YCRdJywgIlxcJTAiKQogICAgICAgICAgICB0YWJsZS5pbnNlcnQobGluZSwgIlsiIC4uIGRlc2NyaXB0aW9uIC4uICJdIikKICAgICAgICBlbmQKICAgICAgICBpZiBvcHRpb24uX21heGFyZ3MgPT0gbWF0aC5odWdlIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGxpbmUsICI6KiIpCiAgICAgICAgZW5kCiAgICAgICAgaWYgb3B0aW9uLl9jaG9pY2VzIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGxpbmUsICI6IDooIiAuLiB0YWJsZS5jb25jYXQob3B0aW9uLl9jaG9pY2VzLCAiICIpIC4uICIpIikKICAgICAgICBlbHNlaWYgb3B0aW9uLl9tYXhhcmdzID4gMCB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChsaW5lLCAiOiA6X2ZpbGVzIikKICAgICAgICBlbmQKICAgICAgICB0YWJsZS5pbnNlcnQobGluZSwgJyInKQogICAgICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyAyKSAuLiB0YWJsZS5jb25jYXQobGluZSkpCiAgICBlbmQKCiAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50KSAuLiAiKSIpCiAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50KSAuLiAiX2FyZ3VtZW50cyAtcyAtUyBcXCIpCiAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50ICsgMikgLi4gIiRvcHRpb25zIFxcIikKCiAgICBpZiBzZWxmLl9pc19oZWxwX2NvbW1hbmQgdGhlbgogICAgICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyAyKSAuLiAnIjogOignIC4uIHNlbGYuX3BhcmVudDpfZ2V0X2NvbW1hbmRzKCkgLi4gJykiIFxcJykKICAgIGVsc2UKICAgICAgICBmb3IgXywgYXJndW1lbnQgaW4gaXBhaXJzKHNlbGYuX2FyZ3VtZW50cykgZG8KICAgICAgICAgICAgbG9jYWwgc3BlYwogICAgICAgICAgICBpZiBhcmd1bWVudC5fY2hvaWNlcyB0aGVuCiAgICAgICAgICAgICAgICBzcGVjID0gIjogOigiIC4uIHRhYmxlLmNvbmNhdChhcmd1bWVudC5fY2hvaWNlcywgIiAiKSAuLiAiKSIKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc3BlYyA9ICI6IDpfZmlsZXMiCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICBpZiBhcmd1bWVudC5fbWF4YXJncyA9PSBtYXRoLmh1Z2UgdGhlbgogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCArIDIpIC4uICciKicgLi4gc3BlYyAuLiAnIiBcXCcpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICAgICAgZm9yIF8gPSAxLCBhcmd1bWVudC5fbWF4YXJncyBkbwogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCArIDIpIC4uICciJyAuLiBzcGVjIC4uICciIFxcJykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCgogICAgICAgIGlmICNzZWxmLl9jb21tYW5kcyA+IDAgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50ICsgMikgLi4gJyI6IDpfJyAuLiBjbWRfbmFtZSAuLiAnX2NtZHMiIFxcJykKICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCArIDIpIC4uICciKjo6IDotPmFyZ3MiIFxcJykKICAgICAgICBlbmQKICAgIGVuZAoKICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyAyKSAuLiAiJiYgcmV0dXJuIDAiKQplbmQKCmZ1bmN0aW9uIFBhcnNlcjpfenNoX2NtZHMoYnVmLCBjbWRfbmFtZSkKICAgIHRhYmxlLmluc2VydChidWYsICJcbl8iIC4uIGNtZF9uYW1lIC4uICJfY21kcygpIHsiKQogICAgdGFibGUuaW5zZXJ0KGJ1ZiwgIiAgbG9jYWwgLWEgY29tbWFuZHM9KCIpCgogICAgZm9yIF8sIGNvbW1hbmQgaW4gaXBhaXJzKHNlbGYuX2NvbW1hbmRzKSBkbwogICAgICAgIGxvY2FsIGxpbmUgPSB7fQogICAgICAgIGlmICNjb21tYW5kLl9hbGlhc2VzID4gMSB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChsaW5lLCAieyIgLi4gdGFibGUuY29uY2F0KGNvbW1hbmQuX2FsaWFzZXMsICIsIikgLi4gJ30iJykKICAgICAgICBlbHNlCiAgICAgICAgICAgIHRhYmxlLmluc2VydChsaW5lLCAnIicgLi4gY29tbWFuZC5fbmFtZSkKICAgICAgICBlbmQKICAgICAgICBpZiBjb21tYW5kLl9kZXNjcmlwdGlvbiB0aGVuCiAgICAgICAgICAgIHRhYmxlLmluc2VydChsaW5lLCAiOiIgLi4gZ2V0X3Nob3J0X2Rlc2NyaXB0aW9uKGNvbW1hbmQpOmdzdWIoJ1siYCRdJywgIlxcJTAiKSkKICAgICAgICBlbmQKICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAiICAgICIgLi4gdGFibGUuY29uY2F0KGxpbmUpIC4uICciJykKICAgIGVuZAoKICAgIHRhYmxlLmluc2VydChidWYsICcgIClcbiAgX2Rlc2NyaWJlICJjb21tYW5kIiBjb21tYW5kc1xufScpCmVuZAoKZnVuY3Rpb24gUGFyc2VyOl96c2hfY29tcGxldGVfaGVscChidWYsIGNtZHNfYnVmLCBjbWRfbmFtZSwgaW5kZW50KQogICAgaWYgI3NlbGYuX2NvbW1hbmRzID09IDAgdGhlbgogICAgICAgIHJldHVybgogICAgZW5kCgogICAgc2VsZjpfenNoX2NtZHMoY21kc19idWYsIGNtZF9uYW1lKQogICAgdGFibGUuaW5zZXJ0KGJ1ZiwgIlxuIiAuLiAoIiAiKTpyZXAoaW5kZW50KSAuLiAiY2FzZSAkd29yZHNbMV0gaW4iKQoKICAgIGZvciBfLCBjb21tYW5kIGluIGlwYWlycyhzZWxmLl9jb21tYW5kcykgZG8KICAgICAgICBsb2NhbCBuYW1lID0gY21kX25hbWUgLi4gIl8iIC4uIGNvbW1hbmQuX25hbWUKICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50ICsgMikgLi4gdGFibGUuY29uY2F0KGNvbW1hbmQuX2FsaWFzZXMsICJ8IikgLi4gIikiKQogICAgICAgIGNvbW1hbmQ6X3pzaF9hcmd1bWVudHMoYnVmLCBuYW1lLCBpbmRlbnQgKyA0KQogICAgICAgIGNvbW1hbmQ6X3pzaF9jb21wbGV0ZV9oZWxwKGJ1ZiwgY21kc19idWYsIG5hbWUsIGluZGVudCArIDQpCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCArIDQpIC4uICI7O1xuIikKICAgIGVuZAoKICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQpIC4uICJlc2FjIikKZW5kCgpmdW5jdGlvbiBQYXJzZXI6Z2V0X3pzaF9jb21wbGV0ZSgpCiAgICBzZWxmLl9iYXNlbmFtZSA9IGJhc2VfbmFtZShzZWxmLl9uYW1lKQogICAgYXNzZXJ0KHNlbGY6X2lzX3NoZWxsX3NhZmUoKSkKICAgIGxvY2FsIGJ1ZiA9IHsoIiNjb21wZGVmICVzXG4iKTpmb3JtYXQoc2VsZi5fYmFzZW5hbWUpfQogICAgbG9jYWwgY21kc19idWYgPSB7fQogICAgdGFibGUuaW5zZXJ0KGJ1ZiwgIl8iIC4uIHNlbGYuX2Jhc2VuYW1lIC4uICIoKSB7IikKICAgIGlmICNzZWxmLl9jb21tYW5kcyA+IDAgdGhlbgogICAgICAgIHRhYmxlLmluc2VydChidWYsICIgIGxvY2FsIGNvbnRleHQgc3RhdGUgc3RhdGVfZGVzY3IgbGluZSIpCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgIiAgdHlwZXNldCAtQSBvcHRfYXJnc1xuIikKICAgIGVuZAogICAgc2VsZjpfenNoX2FyZ3VtZW50cyhidWYsIHNlbGYuX2Jhc2VuYW1lLCAyKQogICAgc2VsZjpfenNoX2NvbXBsZXRlX2hlbHAoYnVmLCBjbWRzX2J1Ziwgc2VsZi5fYmFzZW5hbWUsIDIpCiAgICB0YWJsZS5pbnNlcnQoYnVmLCAiXG4gIHJldHVybiAxIikKICAgIHRhYmxlLmluc2VydChidWYsICJ9IikKCiAgICBsb2NhbCByZXN1bHQgPSB0YWJsZS5jb25jYXQoYnVmLCAiXG4iKQogICAgaWYgI2NtZHNfYnVmID4gMCB0aGVuCiAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uICJcbiIgLi4gdGFibGUuY29uY2F0KGNtZHNfYnVmLCAiXG4iKQogICAgZW5kCiAgICByZXR1cm4gcmVzdWx0IC4uICJcblxuXyIgLi4gc2VsZi5fYmFzZW5hbWUgLi4gIlxuIgplbmQKCmxvY2FsIGZ1bmN0aW9uIGZpc2hfZXNjYXBlKHN0cmluZykKICAgIHJldHVybiBzdHJpbmc6Z3N1YigiW1xcJ10iLCAiXFwlMCIpCmVuZAoKZnVuY3Rpb24gUGFyc2VyOl9maXNoX2dldF9jbWQoYnVmLCBpbmRlbnQpCiAgICBpZiAjc2VsZi5fY29tbWFuZHMgPT0gMCB0aGVuCiAgICAgICAgcmV0dXJuCiAgICBlbmQKCiAgICB0YWJsZS5pbnNlcnQoYnVmLCAoIiAiKTpyZXAoaW5kZW50KSAuLiAic2V0IC1lIGNtZGxpbmVbMV0iKQogICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCkgLi4gImZvciBhcmcgaW4gJGNtZGxpbmUiKQogICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCArIDQpIC4uICJzd2l0Y2ggJGFyZyIpCgogICAgZm9yIF8sIGNvbW1hbmQgaW4gaXBhaXJzKHNlbGYuX2NvbW1hbmRzKSBkbwogICAgICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyA4KSAuLiAiY2FzZSAiIC4uIHRhYmxlLmNvbmNhdChjb21tYW5kLl9hbGlhc2VzLCAiICIpKQogICAgICAgIHRhYmxlLmluc2VydChidWYsICgiICIpOnJlcChpbmRlbnQgKyAxMikgLi4gInNldCBjbWQgJGNtZCAiIC4uIGNvbW1hbmQuX25hbWUpCiAgICAgICAgY29tbWFuZDpfZmlzaF9nZXRfY21kKGJ1ZiwgaW5kZW50ICsgMTIpCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCArIDEyKSAuLiAiYnJlYWsiKQogICAgZW5kCgogICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCArIDQpIC4uICJlbmQiKQogICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKCIgIik6cmVwKGluZGVudCkgLi4gImVuZCIpCmVuZAoKZnVuY3Rpb24gUGFyc2VyOl9maXNoX2NvbXBsZXRlX2hlbHAoYnVmLCBiYXNlbmFtZSkKICAgIGxvY2FsIHByZWZpeCA9ICJjb21wbGV0ZSAtYyAiIC4uIGJhc2VuYW1lCiAgICB0YWJsZS5pbnNlcnQoYnVmLCAiIikKCiAgICBmb3IgXywgY29tbWFuZCBpbiBpcGFpcnMoc2VsZi5fY29tbWFuZHMpIGRvCiAgICAgICAgbG9jYWwgYWxpYXNlcyA9IHRhYmxlLmNvbmNhdChjb21tYW5kLl9hbGlhc2VzLCAiICIpCiAgICAgICAgbG9jYWwgbGluZQogICAgICAgIGlmIHNlbGYuX3BhcmVudCB0aGVuCiAgICAgICAgICAgIGxpbmUgPSAoIiVzIC1uICdfX2Zpc2hfJXNfdXNpbmdfY29tbWFuZCAlcycgLXhhICclcyciKQogICAgICAgICAgICAgICAgICAgIDpmb3JtYXQocHJlZml4LCBiYXNlbmFtZSwgc2VsZjpfZ2V0X2Z1bGxuYW1lKHRydWUpLCBhbGlhc2VzKQogICAgICAgIGVsc2UKICAgICAgICAgICAgbGluZSA9ICgiJXMgLW4gJ19fZmlzaF8lc191c2luZ19jb21tYW5kJyAteGEgJyVzJyIpOmZvcm1hdChwcmVmaXgsIGJhc2VuYW1lLCBhbGlhc2VzKQogICAgICAgIGVuZAogICAgICAgIGlmIGNvbW1hbmQuX2Rlc2NyaXB0aW9uIHRoZW4KICAgICAgICAgICAgbGluZSA9ICgiJXMgLWQgJyVzJyIpOmZvcm1hdChsaW5lLCBmaXNoX2VzY2FwZShnZXRfc2hvcnRfZGVzY3JpcHRpb24oY29tbWFuZCkpKQogICAgICAgIGVuZAogICAgICAgIHRhYmxlLmluc2VydChidWYsIGxpbmUpCiAgICBlbmQKCiAgICBpZiBzZWxmLl9pc19oZWxwX2NvbW1hbmQgdGhlbgogICAgICAgIGxvY2FsIGxpbmUgPSAoIiVzIC1uICdfX2Zpc2hfJXNfdXNpbmdfY29tbWFuZCAlcycgLXhhICclcyciKQogICAgICAgICAgICAgICAgOmZvcm1hdChwcmVmaXgsIGJhc2VuYW1lLCBzZWxmOl9nZXRfZnVsbG5hbWUodHJ1ZSksIHNlbGYuX3BhcmVudDpfZ2V0X2NvbW1hbmRzKCkpCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgbGluZSkKICAgIGVuZAoKICAgIGZvciBfLCBvcHRpb24gaW4gaXBhaXJzKHNlbGYuX29wdGlvbnMpIGRvCiAgICAgICAgbG9jYWwgcGFydHMgPSB7cHJlZml4fQoKICAgICAgICBpZiBzZWxmLl9wYXJlbnQgdGhlbgogICAgICAgICAgICB0YWJsZS5pbnNlcnQocGFydHMsICItbiAnX19maXNoXyIgLi4gYmFzZW5hbWUgLi4gIl9zZWVuX2NvbW1hbmQgIiAuLiBzZWxmOl9nZXRfZnVsbG5hbWUodHJ1ZSkgLi4gIiciKQogICAgICAgIGVuZAoKICAgICAgICBmb3IgXywgYWxpYXMgaW4gaXBhaXJzKG9wdGlvbi5fYWxpYXNlcykgZG8KICAgICAgICAgICAgaWYgYWxpYXM6bWF0Y2goIl4lLS4kIikgdGhlbgogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcnRzLCAiLXMgIiAuLiBhbGlhczpzdWIoMikpCiAgICAgICAgICAgIGVsc2VpZiBhbGlhczptYXRjaCgiXiUtJS0uKyIpIHRoZW4KICAgICAgICAgICAgICAgIHRhYmxlLmluc2VydChwYXJ0cywgIi1sICIgLi4gYWxpYXM6c3ViKDMpKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgaWYgb3B0aW9uLl9jaG9pY2VzIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcnRzLCAiLXhhICciIC4uIHRhYmxlLmNvbmNhdChvcHRpb24uX2Nob2ljZXMsICIgIikgLi4gIiciKQogICAgICAgIGVsc2VpZiBvcHRpb24uX21pbmFyZ3MgPiAwIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcnRzLCAiLXIiKQogICAgICAgIGVuZAoKICAgICAgICBpZiBvcHRpb24uX2Rlc2NyaXB0aW9uIHRoZW4KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHBhcnRzLCAiLWQgJyIgLi4gZmlzaF9lc2NhcGUoZ2V0X3Nob3J0X2Rlc2NyaXB0aW9uKG9wdGlvbikpIC4uICInIikKICAgICAgICBlbmQKCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgdGFibGUuY29uY2F0KHBhcnRzLCAiICIpKQogICAgZW5kCgogICAgZm9yIF8sIGNvbW1hbmQgaW4gaXBhaXJzKHNlbGYuX2NvbW1hbmRzKSBkbwogICAgICAgIGNvbW1hbmQ6X2Zpc2hfY29tcGxldGVfaGVscChidWYsIGJhc2VuYW1lKQogICAgZW5kCmVuZAoKZnVuY3Rpb24gUGFyc2VyOmdldF9maXNoX2NvbXBsZXRlKCkKICAgIHNlbGYuX2Jhc2VuYW1lID0gYmFzZV9uYW1lKHNlbGYuX25hbWUpCiAgICBhc3NlcnQoc2VsZjpfaXNfc2hlbGxfc2FmZSgpKQogICAgbG9jYWwgYnVmID0ge30KCiAgICBpZiAjc2VsZi5fY29tbWFuZHMgPiAwIHRoZW4KICAgICAgICB0YWJsZS5pbnNlcnQoYnVmLCAoW1sKZnVuY3Rpb24gX19maXNoXyVzX3ByaW50X2NvbW1hbmQKICAgIHNldCAtbCBjbWRsaW5lIChjb21tYW5kbGluZSAtcG9jKQogICAgc2V0IC1sIGNtZF1dKTpmb3JtYXQoc2VsZi5fYmFzZW5hbWUpKQogICAgICAgIHNlbGY6X2Zpc2hfZ2V0X2NtZChidWYsIDQpCiAgICAgICAgdGFibGUuaW5zZXJ0KGJ1ZiwgKFtbCiAgICBlY2hvICIkY21kIgplbmQKCmZ1bmN0aW9uIF9fZmlzaF8lc191c2luZ19jb21tYW5kCiAgICB0ZXN0IChfX2Zpc2hfJXNfcHJpbnRfY29tbWFuZCkgPSAiJGFyZ3YiCiAgICBhbmQgcmV0dXJuIDAKICAgIG9yIHJldHVybiAxCmVuZAoKZnVuY3Rpb24gX19maXNoXyVzX3NlZW5fY29tbWFuZAogICAgc3RyaW5nIG1hdGNoIC1xICIkYXJndioiIChfX2Zpc2hfJXNfcHJpbnRfY29tbWFuZCkKICAgIGFuZCByZXR1cm4gMAogICAgb3IgcmV0dXJuIDEKZW5kXV0pOmZvcm1hdChzZWxmLl9iYXNlbmFtZSwgc2VsZi5fYmFzZW5hbWUsIHNlbGYuX2Jhc2VuYW1lLCBzZWxmLl9iYXNlbmFtZSkpCiAgICBlbmQKCiAgICBzZWxmOl9maXNoX2NvbXBsZXRlX2hlbHAoYnVmLCBzZWxmLl9iYXNlbmFtZSkKICAgIHJldHVybiB0YWJsZS5jb25jYXQoYnVmLCAiXG4iKSAuLiAiXG4iCmVuZAoKbG9jYWwgZnVuY3Rpb24gZ2V0X3RpcChjb250ZXh0LCB3cm9uZ19uYW1lKQogICAgbG9jYWwgY29udGV4dF9wb29sID0ge30KICAgIGxvY2FsIHBvc3NpYmxlX25hbWUKICAgIGxvY2FsIHBvc3NpYmxlX25hbWVzID0ge30KCiAgICBmb3IgbmFtZSBpbiBwYWlycyhjb250ZXh0KSBkbwogICAgICAgIGlmIHR5cGUobmFtZSkgPT0gInN0cmluZyIgdGhlbgogICAgICAgICAgICBmb3IgaSA9IDEsICNuYW1lIGRvCiAgICAgICAgICAgICAgICBwb3NzaWJsZV9uYW1lID0gbmFtZTpzdWIoMSwgaSAtIDEpIC4uIG5hbWU6c3ViKGkgKyAxKQoKICAgICAgICAgICAgICAgIGlmIG5vdCBjb250ZXh0X3Bvb2xbcG9zc2libGVfbmFtZV0gdGhlbgogICAgICAgICAgICAgICAgICAgIGNvbnRleHRfcG9vbFtwb3NzaWJsZV9uYW1lXSA9IHt9CiAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoY29udGV4dF9wb29sW3Bvc3NpYmxlX25hbWVdLCBuYW1lKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAoKICAgIGZvciBpID0gMSwgI3dyb25nX25hbWUgKyAxIGRvCiAgICAgICAgcG9zc2libGVfbmFtZSA9IHdyb25nX25hbWU6c3ViKDEsIGkgLSAxKSAuLiB3cm9uZ19uYW1lOnN1YihpICsgMSkKCiAgICAgICAgaWYgY29udGV4dFtwb3NzaWJsZV9uYW1lXSB0aGVuCiAgICAgICAgICAgIHBvc3NpYmxlX25hbWVzW3Bvc3NpYmxlX25hbWVdID0gdHJ1ZQogICAgICAgIGVsc2VpZiBjb250ZXh0X3Bvb2xbcG9zc2libGVfbmFtZV0gdGhlbgogICAgICAgICAgICBmb3IgXywgbmFtZSBpbiBpcGFpcnMoY29udGV4dF9wb29sW3Bvc3NpYmxlX25hbWVdKSBkbwogICAgICAgICAgICAgICAgcG9zc2libGVfbmFtZXNbbmFtZV0gPSB0cnVlCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgZW5kCgogICAgbG9jYWwgZmlyc3QgPSBuZXh0KHBvc3NpYmxlX25hbWVzKQoKICAgIGlmIGZpcnN0IHRoZW4KICAgICAgICBpZiBuZXh0KHBvc3NpYmxlX25hbWVzLCBmaXJzdCkgdGhlbgogICAgICAgICAgICBsb2NhbCBwb3NzaWJsZV9uYW1lc19hcnIgPSB7fQoKICAgICAgICAgICAgZm9yIG5hbWUgaW4gcGFpcnMocG9zc2libGVfbmFtZXMpIGRvCiAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQocG9zc2libGVfbmFtZXNfYXJyLCAiJyIgLi4gbmFtZSAuLiAiJyIpCiAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgdGFibGUuc29ydChwb3NzaWJsZV9uYW1lc19hcnIpCiAgICAgICAgICAgIHJldHVybiAiXG5EaWQgeW91IG1lYW4gb25lIG9mIHRoZXNlOiAiIC4uIHRhYmxlLmNvbmNhdChwb3NzaWJsZV9uYW1lc19hcnIsICIgIikgLi4gIj8iCiAgICAgICAgZWxzZQogICAgICAgICAgICByZXR1cm4gIlxuRGlkIHlvdSBtZWFuICciIC4uIGZpcnN0IC4uICInPyIKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICByZXR1cm4gIiIKICAgIGVuZAplbmQKCmxvY2FsIEVsZW1lbnRTdGF0ZSA9IGNsYXNzKHsKICAgIGludm9jYXRpb25zID0gMAp9KQoKZnVuY3Rpb24gRWxlbWVudFN0YXRlOl9fY2FsbChzdGF0ZSwgZWxlbWVudCkKICAgIHNlbGYuc3RhdGUgPSBzdGF0ZQogICAgc2VsZi5yZXN1bHQgPSBzdGF0ZS5yZXN1bHQKICAgIHNlbGYuZWxlbWVudCA9IGVsZW1lbnQKICAgIHNlbGYudGFyZ2V0ID0gZWxlbWVudC5fdGFyZ2V0IG9yIGVsZW1lbnQ6X2dldF9kZWZhdWx0X3RhcmdldCgpCiAgICBzZWxmLmFjdGlvbiwgc2VsZi5yZXN1bHRbc2VsZi50YXJnZXRdID0gZWxlbWVudDpfZ2V0X2FjdGlvbigpCiAgICByZXR1cm4gc2VsZgplbmQKCmZ1bmN0aW9uIEVsZW1lbnRTdGF0ZTplcnJvcihmbXQsIC4uLikKICAgIHNlbGYuc3RhdGU6ZXJyb3IoZm10LCAuLi4pCmVuZAoKZnVuY3Rpb24gRWxlbWVudFN0YXRlOmNvbnZlcnQoYXJndW1lbnQsIGluZGV4KQogICAgbG9jYWwgY29udmVydGVyID0gc2VsZi5lbGVtZW50Ll9jb252ZXJ0CgogICAgaWYgY29udmVydGVyIHRoZW4KICAgICAgICBsb2NhbCBvaywgZXJyCgogICAgICAgIGlmIHR5cGUoY29udmVydGVyKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgb2ssIGVyciA9IGNvbnZlcnRlcihhcmd1bWVudCkKICAgICAgICBlbHNlaWYgdHlwZShjb252ZXJ0ZXJbaW5kZXhdKSA9PSAiZnVuY3Rpb24iIHRoZW4KICAgICAgICAgICAgb2ssIGVyciA9IGNvbnZlcnRlcltpbmRleF0oYXJndW1lbnQpCiAgICAgICAgZWxzZQogICAgICAgICAgICBvayA9IGNvbnZlcnRlclthcmd1bWVudF0KICAgICAgICBlbmQKCiAgICAgICAgaWYgb2sgPT0gbmlsIHRoZW4KICAgICAgICAgICAgc2VsZjplcnJvcihlcnIgYW5kICIlcyIgb3IgIm1hbGZvcm1lZCBhcmd1bWVudCAnJXMnIiwgZXJyIG9yIGFyZ3VtZW50KQogICAgICAgIGVuZAoKICAgICAgICBhcmd1bWVudCA9IG9rCiAgICBlbmQKCiAgICByZXR1cm4gYXJndW1lbnQKZW5kCgpmdW5jdGlvbiBFbGVtZW50U3RhdGU6ZGVmYXVsdChtb2RlKQogICAgcmV0dXJuIHNlbGYuZWxlbWVudC5fZGVmbW9kZTpmaW5kKG1vZGUpIGFuZCBzZWxmLmVsZW1lbnQuX2RlZmF1bHQKZW5kCgpsb2NhbCBmdW5jdGlvbiBib3VuZChub3VuLCBtaW4sIG1heCwgaXNfbWF4KQogICAgbG9jYWwgcmVzID0gIiIKCiAgICBpZiBtaW4gfj0gbWF4IHRoZW4KICAgICAgICByZXMgPSAiYXQgIiAuLiAoaXNfbWF4IGFuZCAibW9zdCIgb3IgImxlYXN0IikgLi4gIiAiCiAgICBlbmQKCiAgICBsb2NhbCBudW1iZXIgPSBpc19tYXggYW5kIG1heCBvciBtaW4KICAgIHJldHVybiByZXMgLi4gdG9zdHJpbmcobnVtYmVyKSAuLiAiICIgLi4gbm91biAuLiAgKG51bWJlciA9PSAxIGFuZCAiIiBvciAicyIpCmVuZAoKZnVuY3Rpb24gRWxlbWVudFN0YXRlOnNldF9uYW1lKGFsaWFzKQogICAgc2VsZi5uYW1lID0gKCIlcyAnJXMnIik6Zm9ybWF0KGFsaWFzIGFuZCAib3B0aW9uIiBvciAiYXJndW1lbnQiLCBhbGlhcyBvciBzZWxmLmVsZW1lbnQuX25hbWUpCmVuZAoKZnVuY3Rpb24gRWxlbWVudFN0YXRlOmludm9rZSgpCiAgICBzZWxmLm9wZW4gPSB0cnVlCiAgICBzZWxmLm92ZXJ3cml0ZSA9IGZhbHNlCgogICAgaWYgc2VsZi5pbnZvY2F0aW9ucyA+PSBzZWxmLmVsZW1lbnQuX21heGNvdW50IHRoZW4KICAgICAgICBpZiBzZWxmLmVsZW1lbnQuX292ZXJ3cml0ZSB0aGVuCiAgICAgICAgICAgIHNlbGYub3ZlcndyaXRlID0gdHJ1ZQogICAgICAgIGVsc2UKICAgICAgICAgICAgbG9jYWwgbnVtX3RpbWVzX3JlcHIgPSBib3VuZCgidGltZSIsIHNlbGYuZWxlbWVudC5fbWluY291bnQsIHNlbGYuZWxlbWVudC5fbWF4Y291bnQsIHRydWUpCiAgICAgICAgICAgIHNlbGY6ZXJyb3IoIiVzIG11c3QgYmUgdXNlZCAlcyIsIHNlbGYubmFtZSwgbnVtX3RpbWVzX3JlcHIpCiAgICAgICAgZW5kCiAgICBlbHNlCiAgICAgICAgc2VsZi5pbnZvY2F0aW9ucyA9IHNlbGYuaW52b2NhdGlvbnMgKyAxCiAgICBlbmQKCiAgICBzZWxmLmFyZ3MgPSB7fQoKICAgIGlmIHNlbGYuZWxlbWVudC5fbWF4YXJncyA8PSAwIHRoZW4KICAgICAgICBzZWxmOmNsb3NlKCkKICAgIGVuZAoKICAgIHJldHVybiBzZWxmLm9wZW4KZW5kCgpmdW5jdGlvbiBFbGVtZW50U3RhdGU6Y2hlY2tfY2hvaWNlcyhhcmd1bWVudCkKICAgIGlmIHNlbGYuZWxlbWVudC5fY2hvaWNlcyB0aGVuCiAgICAgICAgZm9yIF8sIGNob2ljZSBpbiBpcGFpcnMoc2VsZi5lbGVtZW50Ll9jaG9pY2VzKSBkbwogICAgICAgICAgICBpZiBhcmd1bWVudCA9PSBjaG9pY2UgdGhlbgogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAogICAgICAgIGxvY2FsIGNob2ljZXNfbGlzdCA9ICInIiAuLiB0YWJsZS5jb25jYXQoc2VsZi5lbGVtZW50Ll9jaG9pY2VzLCAiJywgJyIpIC4uICInIgogICAgICAgIGxvY2FsIGlzX29wdGlvbiA9IGdldG1ldGF0YWJsZShzZWxmLmVsZW1lbnQpID09IE9wdGlvbgogICAgICAgIHNlbGY6ZXJyb3IoIiVzJXMgbXVzdCBiZSBvbmUgb2YgJXMiLCBpc19vcHRpb24gYW5kICJhcmd1bWVudCBmb3IgIiBvciAiIiwgc2VsZi5uYW1lLCBjaG9pY2VzX2xpc3QpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBFbGVtZW50U3RhdGU6cGFzcyhhcmd1bWVudCkKICAgIHNlbGY6Y2hlY2tfY2hvaWNlcyhhcmd1bWVudCkKICAgIGFyZ3VtZW50ID0gc2VsZjpjb252ZXJ0KGFyZ3VtZW50LCAjc2VsZi5hcmdzICsgMSkKICAgIHRhYmxlLmluc2VydChzZWxmLmFyZ3MsIGFyZ3VtZW50KQoKICAgIGlmICNzZWxmLmFyZ3MgPj0gc2VsZi5lbGVtZW50Ll9tYXhhcmdzIHRoZW4KICAgICAgICBzZWxmOmNsb3NlKCkKICAgIGVuZAoKICAgIHJldHVybiBzZWxmLm9wZW4KZW5kCgpmdW5jdGlvbiBFbGVtZW50U3RhdGU6Y29tcGxldGVfaW52b2NhdGlvbigpCiAgICB3aGlsZSAjc2VsZi5hcmdzIDwgc2VsZi5lbGVtZW50Ll9taW5hcmdzIGRvCiAgICAgICAgc2VsZjpwYXNzKHNlbGYuZWxlbWVudC5fZGVmYXVsdCkKICAgIGVuZAplbmQKCmZ1bmN0aW9uIEVsZW1lbnRTdGF0ZTpjbG9zZSgpCiAgICBpZiBzZWxmLm9wZW4gdGhlbgogICAgICAgIHNlbGYub3BlbiA9IGZhbHNlCgogICAgICAgIGlmICNzZWxmLmFyZ3MgPCBzZWxmLmVsZW1lbnQuX21pbmFyZ3MgdGhlbgogICAgICAgICAgICBpZiBzZWxmOmRlZmF1bHQoImEiKSB0aGVuCiAgICAgICAgICAgICAgICBzZWxmOmNvbXBsZXRlX2ludm9jYXRpb24oKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBpZiAjc2VsZi5hcmdzID09IDAgdGhlbgogICAgICAgICAgICAgICAgICAgIGlmIGdldG1ldGF0YWJsZShzZWxmLmVsZW1lbnQpID09IEFyZ3VtZW50IHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjplcnJvcigibWlzc2luZyAlcyIsIHNlbGYubmFtZSkKICAgICAgICAgICAgICAgICAgICBlbHNlaWYgc2VsZi5lbGVtZW50Ll9tYXhhcmdzID09IDEgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmOmVycm9yKCIlcyByZXF1aXJlcyBhbiBhcmd1bWVudCIsIHNlbGYubmFtZSkKICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgIGVuZAoKICAgICAgICAgICAgICAgIHNlbGY6ZXJyb3IoIiVzIHJlcXVpcmVzICVzIiwgc2VsZi5uYW1lLCBib3VuZCgiYXJndW1lbnQiLCBzZWxmLmVsZW1lbnQuX21pbmFyZ3MsIHNlbGYuZWxlbWVudC5fbWF4YXJncykpCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBsb2NhbCBhcmdzCgogICAgICAgIGlmIHNlbGYuZWxlbWVudC5fbWF4YXJncyA9PSAwIHRoZW4KICAgICAgICAgICAgYXJncyA9IHNlbGYuYXJnc1sxXQogICAgICAgIGVsc2VpZiBzZWxmLmVsZW1lbnQuX21heGFyZ3MgPT0gMSB0aGVuCiAgICAgICAgICAgIGlmIHNlbGYuZWxlbWVudC5fbWluYXJncyA9PSAwIGFuZCBzZWxmLmVsZW1lbnQuX21pbmNvdW50IH49IHNlbGYuZWxlbWVudC5fbWF4Y291bnQgdGhlbgogICAgICAgICAgICAgICAgYXJncyA9IHNlbGYuYXJncwogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBhcmdzID0gc2VsZi5hcmdzWzFdCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgYXJncyA9IHNlbGYuYXJncwogICAgICAgIGVuZAoKICAgICAgICBzZWxmLmFjdGlvbihzZWxmLnJlc3VsdCwgc2VsZi50YXJnZXQsIGFyZ3MsIHNlbGYub3ZlcndyaXRlKQogICAgZW5kCmVuZAoKbG9jYWwgUGFyc2VTdGF0ZSA9IGNsYXNzKHsKICAgIHJlc3VsdCA9IHt9LAogICAgb3B0aW9ucyA9IHt9LAogICAgYXJndW1lbnRzID0ge30sCiAgICBhcmd1bWVudF9pID0gMSwKICAgIGVsZW1lbnRfdG9fbXV0ZXhlcyA9IHt9LAogICAgbXV0ZXhfdG9fZWxlbWVudF9zdGF0ZSA9IHt9LAogICAgY29tbWFuZF9hY3Rpb25zID0ge30KfSkKCmZ1bmN0aW9uIFBhcnNlU3RhdGU6X19jYWxsKHBhcnNlciwgZXJyb3JfaGFuZGxlcikKICAgIHNlbGYucGFyc2VyID0gcGFyc2VyCiAgICBzZWxmLmVycm9yX2hhbmRsZXIgPSBlcnJvcl9oYW5kbGVyCiAgICBzZWxmLmNoYXJzZXQgPSBwYXJzZXI6X3VwZGF0ZV9jaGFyc2V0KCkKICAgIHNlbGY6c3dpdGNoKHBhcnNlcikKICAgIHJldHVybiBzZWxmCmVuZAoKZnVuY3Rpb24gUGFyc2VTdGF0ZTplcnJvcihmbXQsIC4uLikKICAgIHNlbGYuZXJyb3JfaGFuZGxlcihzZWxmLnBhcnNlciwgZm10OmZvcm1hdCguLi4pKQplbmQKCmZ1bmN0aW9uIFBhcnNlU3RhdGU6c3dpdGNoKHBhcnNlcikKICAgIHNlbGYucGFyc2VyID0gcGFyc2VyCgogICAgaWYgcGFyc2VyLl9hY3Rpb24gdGhlbgogICAgICAgIHRhYmxlLmluc2VydChzZWxmLmNvbW1hbmRfYWN0aW9ucywge2FjdGlvbiA9IHBhcnNlci5fYWN0aW9uLCBuYW1lID0gcGFyc2VyLl9uYW1lfSkKICAgIGVuZAoKICAgIGZvciBfLCBvcHRpb24gaW4gaXBhaXJzKHBhcnNlci5fb3B0aW9ucykgZG8KICAgICAgICBvcHRpb24gPSBFbGVtZW50U3RhdGUoc2VsZiwgb3B0aW9uKQogICAgICAgIHRhYmxlLmluc2VydChzZWxmLm9wdGlvbnMsIG9wdGlvbikKCiAgICAgICAgZm9yIF8sIGFsaWFzIGluIGlwYWlycyhvcHRpb24uZWxlbWVudC5fYWxpYXNlcykgZG8KICAgICAgICAgICAgc2VsZi5vcHRpb25zW2FsaWFzXSA9IG9wdGlvbgogICAgICAgIGVuZAogICAgZW5kCgogICAgZm9yIF8sIG11dGV4IGluIGlwYWlycyhwYXJzZXIuX211dGV4ZXMpIGRvCiAgICAgICAgZm9yIF8sIGVsZW1lbnQgaW4gaXBhaXJzKG11dGV4KSBkbwogICAgICAgICAgICBpZiBub3Qgc2VsZi5lbGVtZW50X3RvX211dGV4ZXNbZWxlbWVudF0gdGhlbgogICAgICAgICAgICAgICAgc2VsZi5lbGVtZW50X3RvX211dGV4ZXNbZWxlbWVudF0gPSB7fQogICAgICAgICAgICBlbmQKCiAgICAgICAgICAgIHRhYmxlLmluc2VydChzZWxmLmVsZW1lbnRfdG9fbXV0ZXhlc1tlbGVtZW50XSwgbXV0ZXgpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgXywgYXJndW1lbnQgaW4gaXBhaXJzKHBhcnNlci5fYXJndW1lbnRzKSBkbwogICAgICAgIGFyZ3VtZW50ID0gRWxlbWVudFN0YXRlKHNlbGYsIGFyZ3VtZW50KQogICAgICAgIHRhYmxlLmluc2VydChzZWxmLmFyZ3VtZW50cywgYXJndW1lbnQpCiAgICAgICAgYXJndW1lbnQ6c2V0X25hbWUoKQogICAgICAgIGFyZ3VtZW50Omludm9rZSgpCiAgICBlbmQKCiAgICBzZWxmLmhhbmRsZV9vcHRpb25zID0gcGFyc2VyLl9oYW5kbGVfb3B0aW9ucwogICAgc2VsZi5hcmd1bWVudCA9IHNlbGYuYXJndW1lbnRzW3NlbGYuYXJndW1lbnRfaV0KICAgIHNlbGYuY29tbWFuZHMgPSBwYXJzZXIuX2NvbW1hbmRzCgogICAgZm9yIF8sIGNvbW1hbmQgaW4gaXBhaXJzKHNlbGYuY29tbWFuZHMpIGRvCiAgICAgICAgZm9yIF8sIGFsaWFzIGluIGlwYWlycyhjb21tYW5kLl9hbGlhc2VzKSBkbwogICAgICAgICAgICBzZWxmLmNvbW1hbmRzW2FsaWFzXSA9IGNvbW1hbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFBhcnNlU3RhdGU6Z2V0X29wdGlvbihuYW1lKQogICAgbG9jYWwgb3B0aW9uID0gc2VsZi5vcHRpb25zW25hbWVdCgogICAgaWYgbm90IG9wdGlvbiB0aGVuCiAgICAgICAgc2VsZjplcnJvcigidW5rbm93biBvcHRpb24gJyVzJyVzIiwgbmFtZSwgZ2V0X3RpcChzZWxmLm9wdGlvbnMsIG5hbWUpKQogICAgZWxzZQogICAgICAgIHJldHVybiBvcHRpb24KICAgIGVuZAplbmQKCmZ1bmN0aW9uIFBhcnNlU3RhdGU6Z2V0X2NvbW1hbmQobmFtZSkKICAgIGxvY2FsIGNvbW1hbmQgPSBzZWxmLmNvbW1hbmRzW25hbWVdCgogICAgaWYgbm90IGNvbW1hbmQgdGhlbgogICAgICAgIGlmICNzZWxmLmNvbW1hbmRzID4gMCB0aGVuCiAgICAgICAgICAgIHNlbGY6ZXJyb3IoInVua25vd24gY29tbWFuZCAnJXMnJXMiLCBuYW1lLCBnZXRfdGlwKHNlbGYuY29tbWFuZHMsIG5hbWUpKQogICAgICAgIGVsc2UKICAgICAgICAgICAgc2VsZjplcnJvcigidG9vIG1hbnkgYXJndW1lbnRzIikKICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICByZXR1cm4gY29tbWFuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gUGFyc2VTdGF0ZTpjaGVja19tdXRleGVzKGVsZW1lbnRfc3RhdGUpCiAgICBpZiBzZWxmLmVsZW1lbnRfdG9fbXV0ZXhlc1tlbGVtZW50X3N0YXRlLmVsZW1lbnRdIHRoZW4KICAgICAgICBmb3IgXywgbXV0ZXggaW4gaXBhaXJzKHNlbGYuZWxlbWVudF90b19tdXRleGVzW2VsZW1lbnRfc3RhdGUuZWxlbWVudF0pIGRvCiAgICAgICAgICAgIGxvY2FsIHVzZWRfZWxlbWVudF9zdGF0ZSA9IHNlbGYubXV0ZXhfdG9fZWxlbWVudF9zdGF0ZVttdXRleF0KCiAgICAgICAgICAgIGlmIHVzZWRfZWxlbWVudF9zdGF0ZSBhbmQgdXNlZF9lbGVtZW50X3N0YXRlIH49IGVsZW1lbnRfc3RhdGUgdGhlbgogICAgICAgICAgICAgICAgc2VsZjplcnJvcigiJXMgY2FuIG5vdCBiZSB1c2VkIHRvZ2V0aGVyIHdpdGggJXMiLCBlbGVtZW50X3N0YXRlLm5hbWUsIHVzZWRfZWxlbWVudF9zdGF0ZS5uYW1lKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZWxmLm11dGV4X3RvX2VsZW1lbnRfc3RhdGVbbXV0ZXhdID0gZWxlbWVudF9zdGF0ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIFBhcnNlU3RhdGU6aW52b2tlKG9wdGlvbiwgbmFtZSkKICAgIHNlbGY6Y2xvc2UoKQogICAgb3B0aW9uOnNldF9uYW1lKG5hbWUpCiAgICBzZWxmOmNoZWNrX211dGV4ZXMob3B0aW9uLCBuYW1lKQoKICAgIGlmIG9wdGlvbjppbnZva2UoKSB0aGVuCiAgICAgICAgc2VsZi5vcHRpb24gPSBvcHRpb24KICAgIGVuZAplbmQKCmZ1bmN0aW9uIFBhcnNlU3RhdGU6cGFzcyhhcmcpCiAgICBpZiBzZWxmLm9wdGlvbiB0aGVuCiAgICAgICAgaWYgbm90IHNlbGYub3B0aW9uOnBhc3MoYXJnKSB0aGVuCiAgICAgICAgICAgIHNlbGYub3B0aW9uID0gbmlsCiAgICAgICAgZW5kCiAgICBlbHNlaWYgc2VsZi5hcmd1bWVudCB0aGVuCiAgICAgICAgc2VsZjpjaGVja19tdXRleGVzKHNlbGYuYXJndW1lbnQpCgogICAgICAgIGlmIG5vdCBzZWxmLmFyZ3VtZW50OnBhc3MoYXJnKSB0aGVuCiAgICAgICAgICAgIHNlbGYuYXJndW1lbnRfaSA9IHNlbGYuYXJndW1lbnRfaSArIDEKICAgICAgICAgICAgc2VsZi5hcmd1bWVudCA9IHNlbGYuYXJndW1lbnRzW3NlbGYuYXJndW1lbnRfaV0KICAgICAgICBlbmQKICAgIGVsc2UKICAgICAgICBsb2NhbCBjb21tYW5kID0gc2VsZjpnZXRfY29tbWFuZChhcmcpCiAgICAgICAgc2VsZi5yZXN1bHRbY29tbWFuZC5fdGFyZ2V0IG9yIGNvbW1hbmQuX25hbWVdID0gdHJ1ZQoKICAgICAgICBpZiBzZWxmLnBhcnNlci5fY29tbWFuZF90YXJnZXQgdGhlbgogICAgICAgICAgICBzZWxmLnJlc3VsdFtzZWxmLnBhcnNlci5fY29tbWFuZF90YXJnZXRdID0gY29tbWFuZC5fbmFtZQogICAgICAgIGVuZAoKICAgICAgICBzZWxmOnN3aXRjaChjb21tYW5kKQogICAgZW5kCmVuZAoKZnVuY3Rpb24gUGFyc2VTdGF0ZTpjbG9zZSgpCiAgICBpZiBzZWxmLm9wdGlvbiB0aGVuCiAgICAgICAgc2VsZi5vcHRpb246Y2xvc2UoKQogICAgICAgIHNlbGYub3B0aW9uID0gbmlsCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBQYXJzZVN0YXRlOmZpbmFsaXplKCkKICAgIHNlbGY6Y2xvc2UoKQoKICAgIGZvciBpID0gc2VsZi5hcmd1bWVudF9pLCAjc2VsZi5hcmd1bWVudHMgZG8KICAgICAgICBsb2NhbCBhcmd1bWVudCA9IHNlbGYuYXJndW1lbnRzW2ldCiAgICAgICAgaWYgI2FyZ3VtZW50LmFyZ3MgPT0gMCBhbmQgYXJndW1lbnQ6ZGVmYXVsdCgidSIpIHRoZW4KICAgICAgICAgICAgYXJndW1lbnQ6Y29tcGxldGVfaW52b2NhdGlvbigpCiAgICAgICAgZWxzZQogICAgICAgICAgICBhcmd1bWVudDpjbG9zZSgpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBpZiBzZWxmLnBhcnNlci5fcmVxdWlyZV9jb21tYW5kIGFuZCAjc2VsZi5jb21tYW5kcyA+IDAgdGhlbgogICAgICAgIHNlbGY6ZXJyb3IoImEgY29tbWFuZCBpcyByZXF1aXJlZCIpCiAgICBlbmQKCiAgICBmb3IgXywgb3B0aW9uIGluIGlwYWlycyhzZWxmLm9wdGlvbnMpIGRvCiAgICAgICAgb3B0aW9uLm5hbWUgPSBvcHRpb24ubmFtZSBvciAoIm9wdGlvbiAnJXMnIik6Zm9ybWF0KG9wdGlvbi5lbGVtZW50Ll9uYW1lKQoKICAgICAgICBpZiBvcHRpb24uaW52b2NhdGlvbnMgPT0gMCB0aGVuCiAgICAgICAgICAgIGlmIG9wdGlvbjpkZWZhdWx0KCJ1IikgdGhlbgogICAgICAgICAgICAgICAgb3B0aW9uOmludm9rZSgpCiAgICAgICAgICAgICAgICBvcHRpb246Y29tcGxldGVfaW52b2NhdGlvbigpCiAgICAgICAgICAgICAgICBvcHRpb246Y2xvc2UoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKCiAgICAgICAgbG9jYWwgbWluY291bnQgPSBvcHRpb24uZWxlbWVudC5fbWluY291bnQKCiAgICAgICAgaWYgb3B0aW9uLmludm9jYXRpb25zIDwgbWluY291bnQgdGhlbgogICAgICAgICAgICBpZiBvcHRpb246ZGVmYXVsdCgiYSIpIHRoZW4KICAgICAgICAgICAgICAgIHdoaWxlIG9wdGlvbi5pbnZvY2F0aW9ucyA8IG1pbmNvdW50IGRvCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uOmludm9rZSgpCiAgICAgICAgICAgICAgICAgICAgb3B0aW9uOmNsb3NlKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbHNlaWYgb3B0aW9uLmludm9jYXRpb25zID09IDAgdGhlbgogICAgICAgICAgICAgICAgc2VsZjplcnJvcigibWlzc2luZyAlcyIsIG9wdGlvbi5uYW1lKQogICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICBzZWxmOmVycm9yKCIlcyBtdXN0IGJlIHVzZWQgJXMiLCBvcHRpb24ubmFtZSwgYm91bmQoInRpbWUiLCBtaW5jb3VudCwgb3B0aW9uLmVsZW1lbnQuX21heGNvdW50KSkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBmb3IgaSA9ICNzZWxmLmNvbW1hbmRfYWN0aW9ucywgMSwgLTEgZG8KICAgICAgICBzZWxmLmNvbW1hbmRfYWN0aW9uc1tpXS5hY3Rpb24oc2VsZi5yZXN1bHQsIHNlbGYuY29tbWFuZF9hY3Rpb25zW2ldLm5hbWUpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBQYXJzZVN0YXRlOnBhcnNlKGFyZ3MpCiAgICBmb3IgXywgYXJnIGluIGlwYWlycyhhcmdzKSBkbwogICAgICAgIGxvY2FsIHBsYWluID0gdHJ1ZQoKICAgICAgICBpZiBzZWxmLmhhbmRsZV9vcHRpb25zIHRoZW4KICAgICAgICAgICAgbG9jYWwgZmlyc3QgPSBhcmc6c3ViKDEsIDEpCgogICAgICAgICAgICBpZiBzZWxmLmNoYXJzZXRbZmlyc3RdIHRoZW4KICAgICAgICAgICAgICAgIGlmICNhcmcgPiAxIHRoZW4KICAgICAgICAgICAgICAgICAgICBwbGFpbiA9IGZhbHNlCgogICAgICAgICAgICAgICAgICAgIGlmIGFyZzpzdWIoMiwgMikgPT0gZmlyc3QgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBpZiAjYXJnID09IDIgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VsZi5vcHRpb25zW2FyZ10gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG9wdGlvbiA9IHNlbGY6Z2V0X29wdGlvbihhcmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjppbnZva2Uob3B0aW9uLCBhcmcpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZjpjbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmhhbmRsZV9vcHRpb25zID0gZmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZXF1YWxzID0gYXJnOmZpbmQgIj0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBlcXVhbHMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIG5hbWUgPSBhcmc6c3ViKDEsIGVxdWFscyAtIDEpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgb3B0aW9uID0gc2VsZjpnZXRfb3B0aW9uKG5hbWUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9wdGlvbi5lbGVtZW50Ll9tYXhhcmdzIDw9IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmOmVycm9yKCJvcHRpb24gJyVzJyBkb2VzIG5vdCB0YWtlIGFyZ3VtZW50cyIsIG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6aW52b2tlKG9wdGlvbiwgbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmOnBhc3MoYXJnOnN1YihlcXVhbHMgKyAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBvcHRpb24gPSBzZWxmOmdldF9vcHRpb24oYXJnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6aW52b2tlKG9wdGlvbiwgYXJnKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGkgPSAyLCAjYXJnIGRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhbCBuYW1lID0gZmlyc3QgLi4gYXJnOnN1YihpLCBpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgb3B0aW9uID0gc2VsZjpnZXRfb3B0aW9uKG5hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmOmludm9rZShvcHRpb24sIG5hbWUpCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaSB+PSAjYXJnIGFuZCBvcHRpb24uZWxlbWVudC5fbWF4YXJncyA+IDAgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGY6cGFzcyhhcmc6c3ViKGkgKyAxKSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVuZAoKICAgICAgICBpZiBwbGFpbiB0aGVuCiAgICAgICAgICAgIHNlbGY6cGFzcyhhcmcpCiAgICAgICAgZW5kCiAgICBlbmQKCiAgICBzZWxmOmZpbmFsaXplKCkKICAgIHJldHVybiBzZWxmLnJlc3VsdAplbmQKCmZ1bmN0aW9uIFBhcnNlcjplcnJvcihtc2cpCiAgICBpby5zdGRlcnI6d3JpdGUoKCIlc1xuXG5FcnJvcjogJXNcbiIpOmZvcm1hdChzZWxmOmdldF91c2FnZSgpLCBtc2cpKQogICAgb3MuZXhpdCgxKQplbmQKCi0tIENvbXBhdGliaWxpdHkgd2l0aCBzdHJpY3QubHVhIGFuZCBvdGhlciBjaGVja2VyczoKbG9jYWwgZGVmYXVsdF9jbWRsaW5lID0gcmF3Z2V0KF9HLCAiYXJnIikgb3Ige30KCmZ1bmN0aW9uIFBhcnNlcjpfcGFyc2UoYXJncywgZXJyb3JfaGFuZGxlcikKICAgIHJldHVybiBQYXJzZVN0YXRlKHNlbGYsIGVycm9yX2hhbmRsZXIpOnBhcnNlKGFyZ3Mgb3IgZGVmYXVsdF9jbWRsaW5lKQplbmQKCmZ1bmN0aW9uIFBhcnNlcjpwYXJzZShhcmdzKQogICAgcmV0dXJuIHNlbGY6X3BhcnNlKGFyZ3MsIHNlbGYuZXJyb3IpCmVuZAoKbG9jYWwgZnVuY3Rpb24geHBjYWxsX2Vycm9yX2hhbmRsZXIoZXJyKQogICAgcmV0dXJuIHRvc3RyaW5nKGVycikgLi4gIlxub3JpZ2luYWwgIiAuLiBkZWJ1Zy50cmFjZWJhY2soIiIsIDIpOnN1YigyKQplbmQKCmZ1bmN0aW9uIFBhcnNlcjpwcGFyc2UoYXJncykKICAgIGxvY2FsIHBhcnNlX2Vycm9yCgogICAgbG9jYWwgb2ssIHJlc3VsdCA9IHhwY2FsbChmdW5jdGlvbigpCiAgICAgICAgcmV0dXJuIHNlbGY6X3BhcnNlKGFyZ3MsIGZ1bmN0aW9uKF8sIGVycikKICAgICAgICAgICAgcGFyc2VfZXJyb3IgPSBlcnIKICAgICAgICAgICAgZXJyb3IoZXJyLCAwKQogICAgICAgIGVuZCkKICAgIGVuZCwgeHBjYWxsX2Vycm9yX2hhbmRsZXIpCgogICAgaWYgb2sgdGhlbgogICAgICAgIHJldHVybiB0cnVlLCByZXN1bHQKICAgIGVsc2VpZiBub3QgcGFyc2VfZXJyb3IgdGhlbgogICAgICAgIGVycm9yKHJlc3VsdCwgMCkKICAgIGVsc2UKICAgICAgICByZXR1cm4gZmFsc2UsIHBhcnNlX2Vycm9yCiAgICBlbmQKZW5kCgpsb2NhbCBhcmdwYXJzZSA9IHt9CgphcmdwYXJzZS52ZXJzaW9uID0gIjAuNy4xIgoKc2V0bWV0YXRhYmxlKGFyZ3BhcnNlLCB7X19jYWxsID0gZnVuY3Rpb24oXywgLi4uKQogICAgcmV0dXJuIFBhcnNlcihkZWZhdWx0X2NtZGxpbmVbMF0pOmFkZF9oZWxwKHRydWUpKC4uLikKZW5kfSkKCnJldHVybiBhcmdwYXJzZQo="
